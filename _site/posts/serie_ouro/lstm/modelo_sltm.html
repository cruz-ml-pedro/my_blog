<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pedro Lima">
<meta name="dcterms.date" content="2023-08-05">

<title>PeDrOOM Blog - Cotação do ouro - Parte 5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">PeDrOOM Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../CV.html" rel="" target="">
 <span class="menu-text">Curriculum vitæ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog.html" rel="" target="">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cruz-ml-pedro" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/pedro-lima-8a9356268/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Cotação do ouro - Parte 5</h1>
            <p class="subtitle lead">Modelo LSTM</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Modelagem</div>
                <div class="quarto-category">Série-Temporal</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Pedro Lima </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 5, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#modelagem-the-keras-stateful-lstm-model" id="toc-modelagem-the-keras-stateful-lstm-model" class="nav-link active" data-scroll-target="#modelagem-the-keras-stateful-lstm-model">Modelagem The Keras Stateful LSTM Model</a></li>
  <li><a href="#single-lstm" id="toc-single-lstm" class="nav-link" data-scroll-target="#single-lstm">Single LSTM</a></li>
  <li><a href="#preprocessing-with-recipes" id="toc-preprocessing-with-recipes" class="nav-link" data-scroll-target="#preprocessing-with-recipes">Preprocessing With Recipes</a></li>
  <li><a href="#lstm-plan" id="toc-lstm-plan" class="nav-link" data-scroll-target="#lstm-plan">LSTM Plan</a>
  <ul class="collapse">
  <li><a href="#construindo-o-modelo-lstm" id="toc-construindo-o-modelo-lstm" class="nav-link" data-scroll-target="#construindo-o-modelo-lstm">Construindo o modelo LSTM</a></li>
  <li><a href="#fitting-the-lstm-model" id="toc-fitting-the-lstm-model" class="nav-link" data-scroll-target="#fitting-the-lstm-model">Fitting The LSTM Model</a></li>
  <li><a href="#predicting-using-the-lstm-model" id="toc-predicting-using-the-lstm-model" class="nav-link" data-scroll-target="#predicting-using-the-lstm-model">Predicting Using The LSTM Model</a></li>
  <li><a href="#assessing-performance-of-the-lstm-on-a-single-split" id="toc-assessing-performance-of-the-lstm-on-a-single-split" class="nav-link" data-scroll-target="#assessing-performance-of-the-lstm-on-a-single-split">Assessing Performance Of The LSTM On A Single Split</a></li>
  <li><a href="#visualizing-the-single-prediction" id="toc-visualizing-the-single-prediction" class="nav-link" data-scroll-target="#visualizing-the-single-prediction">Visualizing The Single Prediction</a></li>
  <li><a href="#backtesting-the-lstm-on-all-samples-creating-an-lstm-prediction-function" id="toc-backtesting-the-lstm-on-all-samples-creating-an-lstm-prediction-function" class="nav-link" data-scroll-target="#backtesting-the-lstm-on-all-samples-creating-an-lstm-prediction-function">Backtesting The LSTM On All Samples Creating An LSTM Prediction Function</a></li>
  <li><a href="#mapping-the-lstm-prediction-function-over-the-samples" id="toc-mapping-the-lstm-prediction-function-over-the-samples" class="nav-link" data-scroll-target="#mapping-the-lstm-prediction-function-over-the-samples">Mapping The LSTM Prediction Function Over The Samples</a></li>
  <li><a href="#assessing-the-backtested-performance" id="toc-assessing-the-backtested-performance" class="nav-link" data-scroll-target="#assessing-the-backtested-performance">Assessing The Backtested Performance</a></li>
  <li><a href="#predicting-the-next-10-years" id="toc-predicting-the-next-10-years" class="nav-link" data-scroll-target="#predicting-the-next-10-years">Predicting The Next 10 Years</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Desenvolvendo uma estratégia de Backtesting</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-4_38a3066c20423588ea835e814230c0b5">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizar o backtesting com a função rolling_origin()</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>periods_train <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="sc">*</span> <span class="dv">4</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>periods_test  <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>skip_span     <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>rolling_origin_resamples <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">rolling_origin</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    gold_mean,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">initial    =</span> periods_train,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">assess     =</span> periods_test,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">skip       =</span> skip_span</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>rolling_origin_resamples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Rolling origin forecast resampling 
# A tibble: 3 × 2
  splits          id    
  &lt;list&gt;          &lt;chr&gt; 
1 &lt;split [48/12]&gt; Slice1
2 &lt;split [48/12]&gt; Slice2
3 &lt;split [48/12]&gt; Slice3</code></pre>
</div>
</div>
<p>Criando uma função para visualizar os blocos de Backtest</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-5_b126a59a8331fcfeeeac2e5326981cdd">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting function for a single split</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>plot_split <span class="ot">&lt;-</span> <span class="cf">function</span>(split, <span class="at">expand_y_axis =</span> <span class="cn">TRUE</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">base_size =</span> <span class="dv">14</span>) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Manipulate data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    train_tbl <span class="ot">&lt;-</span> <span class="fu">training</span>(split) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"training"</span>) </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    test_tbl  <span class="ot">&lt;-</span> <span class="fu">testing</span>(split) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"testing"</span>) </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    data_manipulated <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(train_tbl, test_tbl) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tbl_time</span>(<span class="at">index =</span> index) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">key =</span> <span class="fu">fct_relevel</span>(key, <span class="st">"training"</span>, <span class="st">"testing"</span>))</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Collect attributes</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    train_time_summary <span class="ot">&lt;-</span> train_tbl <span class="sc">%&gt;%</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tk_index</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tk_get_timeseries_summary</span>()</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    test_time_summary <span class="ot">&lt;-</span> test_tbl <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tk_index</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tk_get_timeseries_summary</span>()</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> data_manipulated <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value, <span class="at">color =</span> key)) <span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="at">linewidth =</span> size, <span class="at">alpha =</span> alpha) <span class="sc">+</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_tq</span>(<span class="at">base_size =</span> base_size) <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_tq</span>() <span class="sc">+</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">title    =</span> <span class="fu">glue</span>(<span class="st">"Split: {split$id}"</span>),</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"{train_time_summary$start} to {test_time_summary$end}"</span>),</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="st">""</span>, <span class="at">x =</span> <span class="st">""</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (expand_y_axis) {</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        gold_ts_time_summary <span class="ot">&lt;-</span> gold_mean <span class="sc">%&gt;%</span> </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tk_index</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tk_get_timeseries_summary</span>()</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        g <span class="ot">&lt;-</span> g <span class="sc">+</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_x_date</span>(<span class="at">limits =</span> <span class="fu">c</span>(gold_ts_time_summary<span class="sc">$</span>start, </span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>                                    gold_ts_time_summary<span class="sc">$</span>end))</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(g)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Verificando um dos blocos de Backtest</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-6_6b27477a573abf432faf3fddd57e0c26">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rolling_origin_resamples<span class="sc">$</span>splits[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_split</span>(<span class="at">expand_y_axis =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelo_sltm_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<p>Função para colocar os gráficos na escala de tempo do recorte dos dados</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-7_5ac77e8aa9842edd4ae90be256df9f78">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting function that scales to all splits </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>plot_sampling_plan <span class="ot">&lt;-</span> <span class="cf">function</span>(sampling_tbl, <span class="at">expand_y_axis =</span> <span class="cn">TRUE</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">base_size =</span> <span class="dv">14</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">title =</span> <span class="st">"Sampling Plan"</span>) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map plot_split() to sampling_tbl</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    sampling_tbl_with_plots <span class="ot">&lt;-</span> sampling_tbl <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">gg_plots =</span> <span class="fu">map</span>(splits, plot_split, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">expand_y_axis =</span> expand_y_axis,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">alpha =</span> alpha, <span class="at">base_size =</span> base_size))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make plots with cowplot</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    plot_list <span class="ot">&lt;-</span> sampling_tbl_with_plots<span class="sc">$</span>gg_plots </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    p_temp <span class="ot">&lt;-</span> plot_list[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    legend <span class="ot">&lt;-</span> <span class="fu">get_legend</span>(p_temp)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    p_body  <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plot_list, <span class="at">ncol =</span> ncol)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    p_title <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span> </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">draw_label</span>(title, <span class="at">size =</span> <span class="dv">18</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">colour =</span> <span class="fu">palette_light</span>()[[<span class="dv">1</span>]])</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(p_title, p_body, legend, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="dv">1</span>, <span class="fl">0.05</span>))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(g)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotando todos os blocos de teste</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-8_504b62fe625c162c4d796efb6cd61077">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>rolling_origin_resamples <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_sampling_plan</span>(<span class="at">expand_y_axis =</span> T, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">base_size =</span> <span class="dv">10</span>, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">title =</span> <span class="st">"Backtesting Strategy: Rolling Origin Sampling Plan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelo_sltm_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<p>Plotando os gráficos em uma escala mais apropriada “zoom”</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-9_5f0f3dae12c6720f86a5f144a0b6d50b">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>rolling_origin_resamples <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_sampling_plan</span>(<span class="at">expand_y_axis =</span> F, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">base_size =</span> <span class="dv">10</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">title =</span> <span class="st">"Backtesting Strategy: Zoomed In"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelo_sltm_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<section id="modelagem-the-keras-stateful-lstm-model" class="level2">
<h2 class="anchored" data-anchor-id="modelagem-the-keras-stateful-lstm-model">Modelagem The Keras Stateful LSTM Model</h2>
</section>
<section id="single-lstm" class="level2">
<h2 class="anchored" data-anchor-id="single-lstm">Single LSTM</h2>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-10_f9865962af1177df22fe249c52986cdb">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>split    <span class="ot">&lt;-</span> rolling_origin_resamples<span class="sc">$</span>splits[[<span class="dv">1</span>]]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>split_id <span class="ot">&lt;-</span> rolling_origin_resamples<span class="sc">$</span>id[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-11_a1502baf408ca0e865200f733b14d0a9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_split</span>(split, <span class="at">expand_y_axis =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">glue</span>(<span class="st">"Split: {split_id}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelo_sltm_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<p>Criando um index para treino e teste e combinando em um df</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-12_f784c72782b3c51dc42b24210720a8fc">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_trn <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df_tst <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    df_trn <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"training"</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    df_tst <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"testing"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tbl_time</span>(<span class="at">index =</span> index)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A time tibble: 60 × 3
# Index:         index
   index      value key     
   &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;   
 1 2013-01-01  162. training
 2 2013-02-01  158. training
 3 2013-03-01  154. training
 4 2013-04-01  144. training
 5 2013-05-01  137. training
 6 2013-06-01  130. training
 7 2013-07-01  124. training
 8 2013-08-01  131. training
 9 2013-09-01  130. training
10 2013-10-01  127. training
# ℹ 50 more rows</code></pre>
</div>
</div>
</section>
<section id="preprocessing-with-recipes" class="level2">
<h2 class="anchored" data-anchor-id="preprocessing-with-recipes">Preprocessing With Recipes</h2>
<p>The LSTM algorithm requires the input data to be centered and scaled. We can preprocess the data using the recipes package.</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-13_0794e72dae38bbe02d429e3bd410acce">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>rec_obj <span class="ot">&lt;-</span> <span class="fu">recipe</span>(value <span class="sc">~</span> ., df) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_sqrt</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_center</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_scale</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>   <span class="co"># step_BoxCox(value) %&gt;% </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prep</span>()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>df_processed_tbl <span class="ot">&lt;-</span> <span class="fu">bake</span>(rec_obj, df)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>df_processed_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 60 × 3
   index      key      value
   &lt;date&gt;     &lt;fct&gt;    &lt;dbl&gt;
 1 2013-01-01 training 3.40 
 2 2013-02-01 training 3.08 
 3 2013-03-01 training 2.80 
 4 2013-04-01 training 1.93 
 5 2013-05-01 training 1.37 
 6 2013-06-01 training 0.733
 7 2013-07-01 training 0.277
 8 2013-08-01 training 0.823
 9 2013-09-01 training 0.783
10 2013-10-01 training 0.500
# ℹ 50 more rows</code></pre>
</div>
</div>
<p>A seguir, vamos capturar o histórico do centro/escala para que possamos inverter o centro e a escala após a modelagem. A transformação da raiz quadrada pode ser revertida ao elevar ao quadrado os valores invertidos do centro/escala.</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-14_dfeef46c246eeb55f7195596a3bbe4b2">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>   center_history <span class="ot">&lt;-</span> rec_obj<span class="sc">$</span>steps[[<span class="dv">2</span>]]<span class="sc">$</span>means[<span class="st">"value"</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>   scale_history  <span class="ot">&lt;-</span> rec_obj<span class="sc">$</span>steps[[<span class="dv">3</span>]]<span class="sc">$</span>sds[<span class="st">"value"</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"center"</span> <span class="ot">=</span> center_history, <span class="st">"scale"</span> <span class="ot">=</span> scale_history)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>center.value  scale.value 
  11.0197810    0.4985484 </code></pre>
</div>
</div>
</section>
<section id="lstm-plan" class="level2">
<h2 class="anchored" data-anchor-id="lstm-plan">LSTM Plan</h2>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-15_e8412d7abaad66268bf4dad27a3a86c7">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model inputs</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>lag_setting  <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="co"># = nrow(df_tst)</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>batch_size   <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>train_length <span class="ot">&lt;-</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">6</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>tsteps       <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>epochs       <span class="ot">&lt;-</span> <span class="dv">50</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-16_dcff4586d04be2f1d0b6812bd4e0da65">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Training Set</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>lag_train_tbl <span class="ot">&lt;-</span> df_processed_tbl <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value_lag =</span> <span class="fu">lag</span>(value, <span class="at">n =</span> lag_setting)) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value_lag)) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(key <span class="sc">==</span> <span class="st">"training"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tail</span>(train_length)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>x_train_vec <span class="ot">&lt;-</span> lag_train_tbl<span class="sc">$</span>value_lag</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>x_train_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> x_train_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(x_train_vec), <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>y_train_vec <span class="ot">&lt;-</span> lag_train_tbl<span class="sc">$</span>value</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>y_train_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> y_train_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(y_train_vec), <span class="dv">1</span>))</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing Set</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>lag_test_tbl <span class="ot">&lt;-</span> df_processed_tbl <span class="sc">%&gt;%</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">value_lag =</span> <span class="fu">lag</span>(value, <span class="at">n =</span> lag_setting)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value_lag)) <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(key <span class="sc">==</span> <span class="st">"testing"</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>x_test_vec <span class="ot">&lt;-</span> lag_test_tbl<span class="sc">$</span>value_lag</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>x_test_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> x_test_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(x_test_vec), <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>y_test_vec <span class="ot">&lt;-</span> lag_test_tbl<span class="sc">$</span>value</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>y_test_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> y_test_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(y_test_vec), <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="construindo-o-modelo-lstm" class="level3">
<h3 class="anchored" data-anchor-id="construindo-o-modelo-lstm">Construindo o modelo LSTM</h3>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-17_142894e40a77bd53a8efb3e2e4bba527">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_lstm</span>(<span class="at">units            =</span> <span class="dv">50</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">input_shape      =</span> <span class="fu">c</span>(tsteps, <span class="dv">1</span>), </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">batch_size       =</span> batch_size,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">return_sequences =</span> <span class="cn">TRUE</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">stateful         =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">layer_lstm</span>(<span class="at">units            =</span> <span class="dv">50</span>, </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">return_sequences =</span> <span class="cn">FALSE</span>, </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">stateful         =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compile</span>(</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">loss =</span> <span class="st">'mae'</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">optimizer =</span> <span class="st">'adam'</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>      ) </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "sequential"
________________________________________________________________________________
 Layer (type)                       Output Shape                    Param #     
================================================================================
 lstm_1 (LSTM)                      (1, 1, 50)                      10400       
 lstm (LSTM)                        (1, 50)                         20200       
 dense (Dense)                      (1, 1)                          51          
================================================================================
Total params: 30,651
Trainable params: 30,651
Non-trainable params: 0
________________________________________________________________________________</code></pre>
</div>
</div>
</section>
<section id="fitting-the-lstm-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-lstm-model">Fitting The LSTM Model</h3>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-18_ee558b06a58a2788768970deebeb3b6b">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>epochs) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(<span class="at">x          =</span> x_train_arr, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y          =</span> y_train_arr, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">batch_size =</span> batch_size,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">epochs     =</span> <span class="dv">1</span>, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose    =</span> <span class="dv">1</span>, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">shuffle    =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    model <span class="sc">%&gt;%</span> <span class="fu">reset_states</span>()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Epoch: "</span>, i)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1/36 [..............................] - ETA: 3:00 - loss: 0.1243
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.4318  
19/36 [==============&gt;...............] - ETA: 0s - loss: 0.5704
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.6901
36/36 [==============================] - 5s 5ms/step - loss: 0.6645
Epoch:  1
 1/36 [..............................] - ETA: 0s - loss: 0.1467
11/36 [========&gt;.....................] - ETA: 0s - loss: 0.3043
24/36 [===================&gt;..........] - ETA: 0s - loss: 0.5850
35/36 [============================&gt;.] - ETA: 0s - loss: 0.5647
36/36 [==============================] - 0s 5ms/step - loss: 0.5695
Epoch:  2
 1/36 [..............................] - ETA: 0s - loss: 0.1486
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.2500
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.4841
36/36 [==============================] - 0s 3ms/step - loss: 0.4988
Epoch:  3
 1/36 [..............................] - ETA: 0s - loss: 0.1409
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2064
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.4307
36/36 [==============================] - 0s 3ms/step - loss: 0.4298
Epoch:  4
 1/36 [..............................] - ETA: 0s - loss: 0.1175
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.2427
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.4171
36/36 [==============================] - 0s 4ms/step - loss: 0.4952
Epoch:  5
 1/36 [..............................] - ETA: 0s - loss: 0.1757
16/36 [============&gt;.................] - ETA: 0s - loss: 0.5734
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.5841
36/36 [==============================] - 0s 4ms/step - loss: 0.5819
Epoch:  6
 1/36 [..............................] - ETA: 0s - loss: 0.0461
17/36 [=============&gt;................] - ETA: 0s - loss: 0.4321
26/36 [====================&gt;.........] - ETA: 0s - loss: 0.6246
36/36 [==============================] - 0s 4ms/step - loss: 0.5631
Epoch:  7
 1/36 [..............................] - ETA: 0s - loss: 0.0969
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2807
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.4755
36/36 [==============================] - 0s 4ms/step - loss: 0.5151
Epoch:  8
 1/36 [..............................] - ETA: 0s - loss: 0.1292
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.2458
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.4488
36/36 [==============================] - 0s 4ms/step - loss: 0.4624
Epoch:  9
 1/36 [..............................] - ETA: 0s - loss: 0.0639
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2729
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.4001
36/36 [==============================] - 0s 4ms/step - loss: 0.4741
Epoch:  10
 1/36 [..............................] - ETA: 0s - loss: 0.1547
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.4588
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.5089
36/36 [==============================] - 0s 4ms/step - loss: 0.5267
Epoch:  11
 1/36 [..............................] - ETA: 0s - loss: 0.0314
11/36 [========&gt;.....................] - ETA: 0s - loss: 0.4457
22/36 [=================&gt;............] - ETA: 0s - loss: 0.4224
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.5152
36/36 [==============================] - 0s 6ms/step - loss: 0.5176
Epoch:  12
 1/36 [..............................] - ETA: 0s - loss: 0.0910
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1971
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.3761
36/36 [==============================] - 0s 4ms/step - loss: 0.4396
Epoch:  13
 1/36 [..............................] - ETA: 0s - loss: 0.0319
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.3109
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.4136
36/36 [==============================] - 0s 4ms/step - loss: 0.4416
Epoch:  14
 1/36 [..............................] - ETA: 0s - loss: 0.1291
16/36 [============&gt;.................] - ETA: 0s - loss: 0.3056
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.4298
36/36 [==============================] - 0s 4ms/step - loss: 0.4613
Epoch:  15
 1/36 [..............................] - ETA: 0s - loss: 0.0386
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.3788
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.4192
36/36 [==============================] - 0s 4ms/step - loss: 0.5487
Epoch:  16
 1/36 [..............................] - ETA: 0s - loss: 0.1373
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2367
26/36 [====================&gt;.........] - ETA: 0s - loss: 0.4756
35/36 [============================&gt;.] - ETA: 0s - loss: 0.4319
36/36 [==============================] - 0s 5ms/step - loss: 0.4471
Epoch:  17
 1/36 [..............................] - ETA: 0s - loss: 0.1056
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.2104
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.3645
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3699
36/36 [==============================] - 0s 5ms/step - loss: 0.3901
Epoch:  18
 1/36 [..............................] - ETA: 0s - loss: 0.0995
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2136
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.3064
36/36 [==============================] - 0s 4ms/step - loss: 0.3577
Epoch:  19
 1/36 [..............................] - ETA: 0s - loss: 0.0615
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2026
23/36 [==================&gt;...........] - ETA: 0s - loss: 0.2314
36/36 [==============================] - 0s 4ms/step - loss: 0.3305
Epoch:  20
 1/36 [..............................] - ETA: 0s - loss: 0.0694
 9/36 [======&gt;.......................] - ETA: 0s - loss: 0.1583
21/36 [================&gt;.............] - ETA: 0s - loss: 0.2660
36/36 [==============================] - 0s 4ms/step - loss: 0.3743
Epoch:  21
 1/36 [..............................] - ETA: 0s - loss: 0.0566
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2504
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3632
36/36 [==============================] - 0s 3ms/step - loss: 0.4082
Epoch:  22
 1/36 [..............................] - ETA: 0s - loss: 0.1442
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1770
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.4192
36/36 [==============================] - 0s 3ms/step - loss: 0.4180
Epoch:  23
 1/36 [..............................] - ETA: 0s - loss: 0.1505
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2297
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3695
36/36 [==============================] - 0s 3ms/step - loss: 0.3876
Epoch:  24
 1/36 [..............................] - ETA: 0s - loss: 0.0478
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.2641
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.3524
36/36 [==============================] - 0s 4ms/step - loss: 0.3763
Epoch:  25
 1/36 [..............................] - ETA: 0s - loss: 0.0894
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2783
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3993
36/36 [==============================] - 0s 3ms/step - loss: 0.4062
Epoch:  26
 1/36 [..............................] - ETA: 0s - loss: 0.0367
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1881
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3248
36/36 [==============================] - 0s 4ms/step - loss: 0.3462
Epoch:  27
 1/36 [..............................] - ETA: 0s - loss: 0.0145
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1862
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3052
36/36 [==============================] - 0s 3ms/step - loss: 0.3250
Epoch:  28
 1/36 [..............................] - ETA: 0s - loss: 0.0817
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2294
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3295
36/36 [==============================] - 0s 3ms/step - loss: 0.3434
Epoch:  29
 1/36 [..............................] - ETA: 0s - loss: 0.0826
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3017
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3068
36/36 [==============================] - 0s 3ms/step - loss: 0.3187
Epoch:  30
 1/36 [..............................] - ETA: 0s - loss: 0.0711
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1930
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.4104
36/36 [==============================] - 0s 4ms/step - loss: 0.4402
Epoch:  31
 1/36 [..............................] - ETA: 0s - loss: 0.0767
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1753
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.3256
36/36 [==============================] - 0s 4ms/step - loss: 0.3594
Epoch:  32
 1/36 [..............................] - ETA: 0s - loss: 0.0837
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1827
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2828
36/36 [==============================] - 0s 3ms/step - loss: 0.3033
Epoch:  33
 1/36 [..............................] - ETA: 0s - loss: 0.0510
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2474
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3199
36/36 [==============================] - 0s 3ms/step - loss: 0.3424
Epoch:  34
 1/36 [..............................] - ETA: 0s - loss: 0.0468
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1937
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.4436
36/36 [==============================] - 0s 3ms/step - loss: 0.4448
Epoch:  35
 1/36 [..............................] - ETA: 0s - loss: 0.0494
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1585
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3010
36/36 [==============================] - 0s 3ms/step - loss: 0.3154
Epoch:  36
 1/36 [..............................] - ETA: 0s - loss: 0.0161
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2359
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3025
36/36 [==============================] - 0s 3ms/step - loss: 0.3217
Epoch:  37
 1/36 [..............................] - ETA: 0s - loss: 0.0493
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1486
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3525
36/36 [==============================] - 0s 3ms/step - loss: 0.3656
Epoch:  38
 1/36 [..............................] - ETA: 0s - loss: 0.0474
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2141
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3205
36/36 [==============================] - 0s 3ms/step - loss: 0.3370
Epoch:  39
 1/36 [..............................] - ETA: 0s - loss: 0.0948
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2909
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3675
36/36 [==============================] - 0s 3ms/step - loss: 0.3881
Epoch:  40
 1/36 [..............................] - ETA: 0s - loss: 0.0078
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1668
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3506
36/36 [==============================] - 0s 3ms/step - loss: 0.3645
Epoch:  41
 1/36 [..............................] - ETA: 0s - loss: 0.0494
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2053
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2934
36/36 [==============================] - 0s 3ms/step - loss: 0.3140
Epoch:  42
 1/36 [..............................] - ETA: 0s - loss: 0.0443
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2114
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2626
36/36 [==============================] - 0s 3ms/step - loss: 0.2887
Epoch:  43
 1/36 [..............................] - ETA: 0s - loss: 0.0025
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1334
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3064
36/36 [==============================] - 0s 3ms/step - loss: 0.3291
Epoch:  44
 1/36 [..............................] - ETA: 0s - loss: 0.0159
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1999
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2743
36/36 [==============================] - 0s 3ms/step - loss: 0.2980
Epoch:  45
 1/36 [..............................] - ETA: 0s - loss: 0.0955
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2496
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3432
36/36 [==============================] - 0s 3ms/step - loss: 0.3563
Epoch:  46
 1/36 [..............................] - ETA: 0s - loss: 0.0217
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2108
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3665
36/36 [==============================] - 0s 3ms/step - loss: 0.3771
Epoch:  47
 1/36 [..............................] - ETA: 0s - loss: 0.0277
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1914
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.3271
36/36 [==============================] - 0s 4ms/step - loss: 0.3495
Epoch:  48
 1/36 [..............................] - ETA: 0s - loss: 0.0255
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1785
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3308
36/36 [==============================] - 0s 3ms/step - loss: 0.3450
Epoch:  49
 1/36 [..............................] - ETA: 0s - loss: 0.0929
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2178
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3201
36/36 [==============================] - 0s 3ms/step - loss: 0.3302
Epoch:  50</code></pre>
</div>
</div>
</section>
<section id="predicting-using-the-lstm-model" class="level3">
<h3 class="anchored" data-anchor-id="predicting-using-the-lstm-model">Predicting Using The LSTM Model</h3>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-19_bc2a6006bab2e46410bb8c8ee513f857">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>pred_out <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(x_test_arr, <span class="at">batch_size =</span> batch_size) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    .[,<span class="dv">1</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1/12 [=&gt;............................] - ETA: 10s
12/12 [==============================] - 1s 2ms/step</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retransform values</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>pred_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">index   =</span> lag_test_tbl<span class="sc">$</span>index,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">value   =</span> (pred_out <span class="sc">*</span> scale_history <span class="sc">+</span> center_history)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine actual data with predictions</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>tbl_1 <span class="ot">&lt;-</span> df_trn <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"actual"</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>tbl_2 <span class="ot">&lt;-</span> df_tst <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"actual"</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>tbl_3 <span class="ot">&lt;-</span> pred_tbl <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"predict"</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time_bind_rows() to solve dplyr issue</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>time_bind_rows <span class="ot">&lt;-</span> <span class="cf">function</span>(data_1, data_2, index) {</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    index_expr <span class="ot">&lt;-</span> <span class="fu">enquo</span>(index)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(data_1, data_2) <span class="sc">%&gt;%</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tbl_time</span>(<span class="at">index =</span> <span class="sc">!!</span> index_expr)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>ret <span class="ot">&lt;-</span> <span class="fu">list</span>(tbl_1, tbl_2, tbl_3) <span class="sc">%&gt;%</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">reduce</span>(time_bind_rows, <span class="at">index =</span> index) <span class="sc">%&gt;%</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(key, index) <span class="sc">%&gt;%</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">key =</span> <span class="fu">as_factor</span>(key))</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>ret</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A time tibble: 72 × 3
# Index:         index
   index      value key   
   &lt;date&gt;     &lt;dbl&gt; &lt;fct&gt; 
 1 2013-01-01  162. actual
 2 2013-02-01  158. actual
 3 2013-03-01  154. actual
 4 2013-04-01  144. actual
 5 2013-05-01  137. actual
 6 2013-06-01  130. actual
 7 2013-07-01  124. actual
 8 2013-08-01  131. actual
 9 2013-09-01  130. actual
10 2013-10-01  127. actual
# ℹ 62 more rows</code></pre>
</div>
</div>
</section>
<section id="assessing-performance-of-the-lstm-on-a-single-split" class="level3">
<h3 class="anchored" data-anchor-id="assessing-performance-of-the-lstm-on-a-single-split">Assessing Performance Of The LSTM On A Single Split</h3>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-20_f1e1cb74d86b5702931eead4f9aa6bee">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>calc_rmse <span class="ot">&lt;-</span> <span class="cf">function</span>(prediction_tbl) {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    rmse_calculation <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        data <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">spread</span>(<span class="at">key =</span> key, <span class="at">value =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span>index) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(predict)) <span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">truth    =</span> actual,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">estimate =</span> predict</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rmse</span>(truth, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.estimate)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    safe_rmse <span class="ot">&lt;-</span> <span class="fu">possibly</span>(rmse_calculation, <span class="at">otherwise =</span> <span class="cn">NA</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">safe_rmse</span>(prediction_tbl)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>verificando o RMSE</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-21_7eeb29b8d9455f71d5665551f135e955">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_rmse</span>(ret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  .estimate
      &lt;dbl&gt;
1      2.88</code></pre>
</div>
</div>
</section>
<section id="visualizing-the-single-prediction" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-single-prediction">Visualizing The Single Prediction</h3>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-22_6e70dc64a5d74cda9e521349b9af76c6">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup single plot function</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plot_prediction <span class="ot">&lt;-</span> <span class="cf">function</span>(data, id, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">base_size =</span> <span class="dv">14</span>) {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    rmse_val <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(data)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="fu">aes</span>(index, value, <span class="at">color =</span> key)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="at">alpha =</span> alpha, <span class="at">size =</span> size) <span class="sc">+</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_tq</span>(<span class="at">base_size =</span> base_size) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_tq</span>() <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">glue</span>(<span class="st">"{id}, RMSE: {round(rmse_val, digits = 1)}"</span>),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(g)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-23_0fdd6df5cde645d5b99eac3d75c1373d">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ret <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_prediction</span>(<span class="at">id =</span> split_id, <span class="at">alpha =</span> <span class="fl">0.65</span>) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelo_sltm_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-24_1a1e3f1842f78cd6f8cf019562da7676">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># trend &lt;- fit %&gt;% </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    filter(index &gt;=  "2023-01-08", index &lt;= "2023-02-06") %&gt;% </span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    select(trend) %&gt;% </span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    tibble()</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># predito &lt;- ret %&gt;% </span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(key=="predict") %&gt;% </span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     value = value + trend</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># original &lt;- gold_original %&gt;% </span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(index &gt;=  "2023-01-08", index &lt;= "2023-02-06")</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># left_join(original, predito, by = "index") %&gt;% </span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x=index))+</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(y=value.x))+</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(y=value.y$trend), color="blue")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="backtesting-the-lstm-on-all-samples-creating-an-lstm-prediction-function" class="level3">
<h3 class="anchored" data-anchor-id="backtesting-the-lstm-on-all-samples-creating-an-lstm-prediction-function">Backtesting The LSTM On All Samples Creating An LSTM Prediction Function</h3>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-25_c5f65cb6b6209bd5c3722c6f98f89e92">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>predict_keras_lstm <span class="ot">&lt;-</span> <span class="cf">function</span>(split, <span class="at">epochs =</span> <span class="dv">50</span>, ...) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    lstm_prediction <span class="ot">&lt;-</span> <span class="cf">function</span>(split, epochs, ...) {</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.2 Data Setup</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        df_trn <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        df_tst <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>            df_trn <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"training"</span>),</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>            df_tst <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"testing"</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as_tbl_time</span>(<span class="at">index =</span> index)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.3 Preprocessing</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        rec_obj <span class="ot">&lt;-</span> <span class="fu">recipe</span>(value <span class="sc">~</span> ., df) <span class="sc">%&gt;%</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">step_sqrt</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">step_center</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">step_scale</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prep</span>()</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        df_processed_tbl <span class="ot">&lt;-</span> <span class="fu">bake</span>(rec_obj, df)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>        center_history <span class="ot">&lt;-</span> rec_obj<span class="sc">$</span>steps[[<span class="dv">2</span>]]<span class="sc">$</span>means[<span class="st">"value"</span>]</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>        scale_history  <span class="ot">&lt;-</span> rec_obj<span class="sc">$</span>steps[[<span class="dv">3</span>]]<span class="sc">$</span>sds[<span class="st">"value"</span>]</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.4 LSTM Plan</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>        lag_setting  <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="co"># = nrow(df_tst)</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>        batch_size   <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>        train_length <span class="ot">&lt;-</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">5</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        tsteps       <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        epochs       <span class="ot">&lt;-</span> epochs</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.5 Train/Test Setup</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>        lag_train_tbl <span class="ot">&lt;-</span> df_processed_tbl <span class="sc">%&gt;%</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">value_lag =</span> <span class="fu">lag</span>(value, <span class="at">n =</span> lag_setting)) <span class="sc">%&gt;%</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value_lag)) <span class="sc">%&gt;%</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(key <span class="sc">==</span> <span class="st">"training"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tail</span>(train_length)</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>        x_train_vec <span class="ot">&lt;-</span> lag_train_tbl<span class="sc">$</span>value_lag</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>        x_train_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> x_train_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(x_train_vec), <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>        y_train_vec <span class="ot">&lt;-</span> lag_train_tbl<span class="sc">$</span>value</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>        y_train_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> y_train_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(y_train_vec), <span class="dv">1</span>))</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>        lag_test_tbl <span class="ot">&lt;-</span> df_processed_tbl <span class="sc">%&gt;%</span></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">value_lag =</span> <span class="fu">lag</span>(value, <span class="at">n =</span> lag_setting)</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value_lag)) <span class="sc">%&gt;%</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(key <span class="sc">==</span> <span class="st">"testing"</span>)</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>        x_test_vec <span class="ot">&lt;-</span> lag_test_tbl<span class="sc">$</span>value_lag</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>        x_test_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> x_test_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(x_test_vec), <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>        y_test_vec <span class="ot">&lt;-</span> lag_test_tbl<span class="sc">$</span>value</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>        y_test_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> y_test_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(y_test_vec), <span class="dv">1</span>))</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.6 LSTM Model</span></span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>        model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>        model <span class="sc">%&gt;%</span></span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>            <span class="fu">layer_lstm</span>(<span class="at">units            =</span> <span class="dv">50</span>, </span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>                       <span class="at">input_shape      =</span> <span class="fu">c</span>(tsteps, <span class="dv">1</span>), </span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>                       <span class="at">batch_size       =</span> batch_size,</span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>                       <span class="at">return_sequences =</span> <span class="cn">TRUE</span>, </span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stateful         =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>            <span class="fu">layer_lstm</span>(<span class="at">units            =</span> <span class="dv">50</span>, </span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>                       <span class="at">return_sequences =</span> <span class="cn">FALSE</span>, </span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stateful         =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>            <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>)</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a>        model <span class="sc">%&gt;%</span> </span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>            <span class="fu">compile</span>(<span class="at">loss =</span> <span class="st">'mae'</span>, <span class="at">optimizer =</span> <span class="st">'adam'</span>)</span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.7 Fitting LSTM</span></span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>epochs) {</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a>            model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(<span class="at">x          =</span> x_train_arr, </span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y          =</span> y_train_arr, </span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a>                          <span class="at">batch_size =</span> batch_size,</span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a>                          <span class="at">epochs     =</span> <span class="dv">1</span>, </span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>                          <span class="at">verbose    =</span> <span class="dv">1</span>, </span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>                          <span class="at">shuffle    =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a>            model <span class="sc">%&gt;%</span> <span class="fu">reset_states</span>()</span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">"Epoch: "</span>, i)</span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.8 Predict and Return Tidy Data</span></span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make Predictions</span></span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a>        pred_out <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> </span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a>            <span class="fu">predict</span>(x_test_arr, <span class="at">batch_size =</span> batch_size) <span class="sc">%&gt;%</span></span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a>            .[,<span class="dv">1</span>] </span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retransform values</span></span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a>        pred_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a>            <span class="at">index   =</span> lag_test_tbl<span class="sc">$</span>index,</span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a>            <span class="at">value   =</span> (pred_out <span class="sc">*</span> scale_history <span class="sc">+</span> center_history)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Combine actual data with predictions</span></span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a>        tbl_1 <span class="ot">&lt;-</span> df_trn <span class="sc">%&gt;%</span></span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a>            <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"actual"</span>)</span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>        tbl_2 <span class="ot">&lt;-</span> df_tst <span class="sc">%&gt;%</span></span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a>            <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"actual"</span>)</span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a>        tbl_3 <span class="ot">&lt;-</span> pred_tbl <span class="sc">%&gt;%</span></span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a>            <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"predict"</span>)</span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create time_bind_rows() to solve dplyr issue</span></span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a>        time_bind_rows <span class="ot">&lt;-</span> <span class="cf">function</span>(data_1, data_2, index) {</span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a>            index_expr <span class="ot">&lt;-</span> <span class="fu">enquo</span>(index)</span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a>            <span class="fu">bind_rows</span>(data_1, data_2) <span class="sc">%&gt;%</span></span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as_tbl_time</span>(<span class="at">index =</span> <span class="sc">!!</span> index_expr)</span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a>        ret <span class="ot">&lt;-</span> <span class="fu">list</span>(tbl_1, tbl_2, tbl_3) <span class="sc">%&gt;%</span></span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a>            <span class="fu">reduce</span>(time_bind_rows, <span class="at">index =</span> index) <span class="sc">%&gt;%</span></span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a>            <span class="fu">arrange</span>(key, index) <span class="sc">%&gt;%</span></span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">key =</span> <span class="fu">as_factor</span>(key))</span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(ret)</span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a>    safe_lstm <span class="ot">&lt;-</span> <span class="fu">possibly</span>(lstm_prediction, <span class="at">otherwise =</span> <span class="cn">NA</span>)</span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a>    <span class="fu">safe_lstm</span>(split, epochs, ...)</span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>testando</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-26_6d08ca40b3e333f3d80d5719c22e0fae">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict_keras_lstm</span>(split, <span class="at">epochs =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1/36 [..............................] - ETA: 2:05 - loss: 0.1131
17/36 [=============&gt;................] - ETA: 0s - loss: 0.5612  
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7333
36/36 [==============================] - 4s 3ms/step - loss: 0.7037
Epoch:  1
 1/36 [..............................] - ETA: 0s - loss: 0.1400
16/36 [============&gt;.................] - ETA: 0s - loss: 0.3220
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.5406
36/36 [==============================] - 0s 4ms/step - loss: 0.5454
Epoch:  2
 1/36 [..............................] - ETA: 0s - loss: 0.1209
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2583
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.5068
36/36 [==============================] - 0s 3ms/step - loss: 0.5182
Epoch:  3
 1/36 [..............................] - ETA: 0s - loss: 0.1461
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2193
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.3845
36/36 [==============================] - 0s 3ms/step - loss: 0.4089
Epoch:  4
 1/36 [..............................] - ETA: 0s - loss: 0.0806
16/36 [============&gt;.................] - ETA: 0s - loss: 0.3829
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.5230
36/36 [==============================] - 0s 3ms/step - loss: 0.5190
Epoch:  5
 1/36 [..............................] - ETA: 0s - loss: 0.1778
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3816
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.5146
36/36 [==============================] - 0s 4ms/step - loss: 0.5149
Epoch:  6
 1/36 [..............................] - ETA: 0s - loss: 0.0640
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.4098
29/36 [=======================&gt;......] - ETA: 0s - loss: 0.4974
36/36 [==============================] - 0s 4ms/step - loss: 0.5160
Epoch:  7
 1/36 [..............................] - ETA: 0s - loss: 0.1149
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2257
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.4316
36/36 [==============================] - 0s 4ms/step - loss: 0.4561
Epoch:  8
 1/36 [..............................] - ETA: 0s - loss: 0.0993
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1982
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.4050
36/36 [==============================] - 0s 3ms/step - loss: 0.4216
Epoch:  9
 1/36 [..............................] - ETA: 0s - loss: 0.1228
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2277
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.3579
36/36 [==============================] - 0s 4ms/step - loss: 0.3944
Epoch:  10
 1/12 [=&gt;............................] - ETA: 11s
12/12 [==============================] - 1s 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A time tibble: 72 × 3
# Index:         index
   index      value key   
   &lt;date&gt;     &lt;dbl&gt; &lt;fct&gt; 
 1 2013-01-01  162. actual
 2 2013-02-01  158. actual
 3 2013-03-01  154. actual
 4 2013-04-01  144. actual
 5 2013-05-01  137. actual
 6 2013-06-01  130. actual
 7 2013-07-01  124. actual
 8 2013-08-01  131. actual
 9 2013-09-01  130. actual
10 2013-10-01  127. actual
# ℹ 62 more rows</code></pre>
</div>
</div>
</section>
<section id="mapping-the-lstm-prediction-function-over-the-samples" class="level3">
<h3 class="anchored" data-anchor-id="mapping-the-lstm-prediction-function-over-the-samples">Mapping The LSTM Prediction Function Over The Samples</h3>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-27_85f155ce6f0823ce03c5e5423b4dcd5e">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>sample_predictions_lstm_tbl <span class="ot">&lt;-</span> rolling_origin_resamples <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">predict =</span> <span class="fu">map</span>(splits, predict_keras_lstm, <span class="at">epochs =</span> <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1/36 [..............................] - ETA: 2:22 - loss: 0.1293
16/36 [============&gt;.................] - ETA: 0s - loss: 0.5531  
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.7498
36/36 [==============================] - 4s 3ms/step - loss: 0.7178
Epoch:  1
 1/36 [..............................] - ETA: 0s - loss: 0.1395
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3604
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.5733
36/36 [==============================] - 0s 3ms/step - loss: 0.5627
Epoch:  2
 1/36 [..............................] - ETA: 0s - loss: 0.1365
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2893
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.5449
36/36 [==============================] - 0s 3ms/step - loss: 0.5338
Epoch:  3
 1/36 [..............................] - ETA: 0s - loss: 0.1493
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2044
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.3803
36/36 [==============================] - 0s 4ms/step - loss: 0.4155
Epoch:  4
 1/36 [..............................] - ETA: 0s - loss: 0.0819
16/36 [============&gt;.................] - ETA: 0s - loss: 0.4520
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.5468
36/36 [==============================] - 0s 4ms/step - loss: 0.5453
Epoch:  5
 1/36 [..............................] - ETA: 0s - loss: 0.1864
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.3830
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.6012
35/36 [============================&gt;.] - ETA: 0s - loss: 0.5206
36/36 [==============================] - 0s 5ms/step - loss: 0.5335
Epoch:  6
 1/36 [..............................] - ETA: 0s - loss: 0.0905
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.3459
26/36 [====================&gt;.........] - ETA: 0s - loss: 0.5613
36/36 [==============================] - 0s 4ms/step - loss: 0.5248
Epoch:  7
 1/36 [..............................] - ETA: 0s - loss: 0.1253
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.2312
26/36 [====================&gt;.........] - ETA: 0s - loss: 0.4667
36/36 [==============================] - 0s 4ms/step - loss: 0.5013
Epoch:  8
 1/36 [..............................] - ETA: 0s - loss: 0.1580
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.2496
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.4226
36/36 [==============================] - 0s 4ms/step - loss: 0.4409
Epoch:  9
 1/36 [..............................] - ETA: 0s - loss: 0.0905
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.2942
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.4302
36/36 [==============================] - 0s 4ms/step - loss: 0.4601
Epoch:  10
 1/36 [..............................] - ETA: 0s - loss: 0.1805
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.3993
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.4885
36/36 [==============================] - 0s 4ms/step - loss: 0.4703
Epoch:  11
 1/36 [..............................] - ETA: 0s - loss: 0.0420
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.4062
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.5588
36/36 [==============================] - 0s 4ms/step - loss: 0.5201
Epoch:  12
 1/36 [..............................] - ETA: 0s - loss: 0.0746
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.2865
24/36 [===================&gt;..........] - ETA: 0s - loss: 0.4345
36/36 [==============================] - 0s 4ms/step - loss: 0.4921
Epoch:  13
 1/36 [..............................] - ETA: 0s - loss: 0.1050
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.2147
24/36 [===================&gt;..........] - ETA: 0s - loss: 0.3511
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3971
36/36 [==============================] - 0s 5ms/step - loss: 0.4144
Epoch:  14
 1/36 [..............................] - ETA: 0s - loss: 0.0978
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1673
23/36 [==================&gt;...........] - ETA: 0s - loss: 0.2998
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3732
36/36 [==============================] - 0s 5ms/step - loss: 0.3942
Epoch:  15
 1/36 [..............................] - ETA: 0s - loss: 0.1381
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.2469
26/36 [====================&gt;.........] - ETA: 0s - loss: 0.3806
36/36 [==============================] - 0s 4ms/step - loss: 0.4020
Epoch:  16
 1/36 [..............................] - ETA: 0s - loss: 0.0988
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2573
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3877
36/36 [==============================] - 0s 3ms/step - loss: 0.4110
Epoch:  17
 1/36 [..............................] - ETA: 0s - loss: 0.1783
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2975
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.4049
36/36 [==============================] - 0s 4ms/step - loss: 0.4429
Epoch:  18
 1/36 [..............................] - ETA: 0s - loss: 0.1018
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.3248
24/36 [===================&gt;..........] - ETA: 0s - loss: 0.4614
36/36 [==============================] - 0s 4ms/step - loss: 0.4601
Epoch:  19
 1/36 [..............................] - ETA: 0s - loss: 0.1772
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.2426
24/36 [===================&gt;..........] - ETA: 0s - loss: 0.3944
36/36 [==============================] - ETA: 0s - loss: 0.4227
36/36 [==============================] - 0s 5ms/step - loss: 0.4227
Epoch:  20
 1/36 [..............................] - ETA: 0s - loss: 0.1457
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.1917
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.3422
36/36 [==============================] - 0s 5ms/step - loss: 0.3707
Epoch:  21
 1/36 [..............................] - ETA: 0s - loss: 0.1353
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.2007
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.3341
36/36 [==============================] - 0s 4ms/step - loss: 0.3983
Epoch:  22
 1/36 [..............................] - ETA: 0s - loss: 0.1229
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1489
23/36 [==================&gt;...........] - ETA: 0s - loss: 0.2384
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2841
36/36 [==============================] - 0s 5ms/step - loss: 0.3214
Epoch:  23
 1/36 [..............................] - ETA: 0s - loss: 0.1348
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.1794
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.3703
36/36 [==============================] - 0s 4ms/step - loss: 0.4169
Epoch:  24
 1/36 [..............................] - ETA: 0s - loss: 0.1636
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1821
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.2690
36/36 [==============================] - 0s 4ms/step - loss: 0.3023
Epoch:  25
 1/36 [..............................] - ETA: 0s - loss: 0.0698
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.2095
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.3802
36/36 [==============================] - 0s 4ms/step - loss: 0.3790
Epoch:  26
 1/36 [..............................] - ETA: 0s - loss: 0.1537
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2179
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.4200
36/36 [==============================] - 0s 4ms/step - loss: 0.4491
Epoch:  27
 1/36 [..............................] - ETA: 0s - loss: 0.2531
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.3155
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.4601
36/36 [==============================] - 0s 4ms/step - loss: 0.4531
Epoch:  28
 1/36 [..............................] - ETA: 0s - loss: 0.0740
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.2099
23/36 [==================&gt;...........] - ETA: 0s - loss: 0.2642
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3904
36/36 [==============================] - 0s 5ms/step - loss: 0.4086
Epoch:  29
 1/36 [..............................] - ETA: 0s - loss: 0.1113
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.2349
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.4397
36/36 [==============================] - 0s 4ms/step - loss: 0.4259
Epoch:  30
 1/36 [..............................] - ETA: 0s - loss: 0.1075
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.1785
24/36 [===================&gt;..........] - ETA: 0s - loss: 0.3077
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3377
36/36 [==============================] - 0s 5ms/step - loss: 0.3546
Epoch:  31
 1/36 [..............................] - ETA: 0s - loss: 0.1164
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.2058
29/36 [=======================&gt;......] - ETA: 0s - loss: 0.3337
36/36 [==============================] - 0s 4ms/step - loss: 0.4077
Epoch:  32
 1/36 [..............................] - ETA: 0s - loss: 0.1603
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.2179
29/36 [=======================&gt;......] - ETA: 0s - loss: 0.3982
36/36 [==============================] - 0s 4ms/step - loss: 0.4160
Epoch:  33
 1/36 [..............................] - ETA: 0s - loss: 0.0897
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1814
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.2648
36/36 [==============================] - 0s 4ms/step - loss: 0.3482
Epoch:  34
 1/36 [..............................] - ETA: 0s - loss: 0.1472
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.2773
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.4083
36/36 [==============================] - 0s 4ms/step - loss: 0.4211
Epoch:  35
 1/36 [..............................] - ETA: 0s - loss: 0.0039
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2432
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3889
36/36 [==============================] - 0s 3ms/step - loss: 0.4053
Epoch:  36
 1/36 [..............................] - ETA: 0s - loss: 0.0608
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2032
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.3470
36/36 [==============================] - 0s 4ms/step - loss: 0.3793
Epoch:  37
 1/36 [..............................] - ETA: 0s - loss: 0.0601
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2094
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3602
36/36 [==============================] - 0s 3ms/step - loss: 0.3726
Epoch:  38
 1/36 [..............................] - ETA: 0s - loss: 0.0647
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1630
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2993
36/36 [==============================] - 0s 3ms/step - loss: 0.3093
Epoch:  39
 1/36 [..............................] - ETA: 0s - loss: 0.1166
16/36 [============&gt;.................] - ETA: 0s - loss: 0.2701
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.4348
36/36 [==============================] - 0s 3ms/step - loss: 0.4350
Epoch:  40
 1/36 [..............................] - ETA: 0s - loss: 0.0306
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2182
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3266
36/36 [==============================] - 0s 3ms/step - loss: 0.3439
Epoch:  41
 1/36 [..............................] - ETA: 0s - loss: 0.0733
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1752
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.5937
36/36 [==============================] - 0s 3ms/step - loss: 0.6043
Epoch:  42
 1/36 [..............................] - ETA: 0s - loss: 0.0153
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1818
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3982
36/36 [==============================] - 0s 3ms/step - loss: 0.4003
Epoch:  43
 1/36 [..............................] - ETA: 0s - loss: 0.0708
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1865
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3292
36/36 [==============================] - 0s 3ms/step - loss: 0.3453
Epoch:  44
 1/36 [..............................] - ETA: 0s - loss: 0.0681
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1888
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3057
36/36 [==============================] - 0s 3ms/step - loss: 0.3170
Epoch:  45
 1/36 [..............................] - ETA: 0s - loss: 0.0065
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1320
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3746
36/36 [==============================] - 0s 3ms/step - loss: 0.3792
Epoch:  46
 1/36 [..............................] - ETA: 0s - loss: 0.0386
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1704
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2923
36/36 [==============================] - 0s 3ms/step - loss: 0.3118
Epoch:  47
 1/36 [..............................] - ETA: 0s - loss: 0.0730
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1829
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2795
36/36 [==============================] - 0s 3ms/step - loss: 0.3002
Epoch:  48
 1/36 [..............................] - ETA: 0s - loss: 0.0295
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1935
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3884
36/36 [==============================] - 0s 3ms/step - loss: 0.3936
Epoch:  49
 1/36 [..............................] - ETA: 0s - loss: 0.0079
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1416
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2533
36/36 [==============================] - 0s 3ms/step - loss: 0.2715
Epoch:  50
 1/12 [=&gt;............................] - ETA: 11s
12/12 [==============================] - 1s 2ms/step

 1/36 [..............................] - ETA: 2:06 - loss: 0.6188
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3858  
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.4170
36/36 [==============================] - 4s 3ms/step - loss: 0.4048
Epoch:  1
 1/36 [..............................] - ETA: 0s - loss: 0.6185
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3626
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3996
36/36 [==============================] - 0s 3ms/step - loss: 0.3883
Epoch:  2
 1/36 [..............................] - ETA: 0s - loss: 0.6241
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3455
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3917
36/36 [==============================] - 0s 3ms/step - loss: 0.3807
Epoch:  3
 1/36 [..............................] - ETA: 0s - loss: 0.6247
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3386
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3856
36/36 [==============================] - 0s 3ms/step - loss: 0.3764
Epoch:  4
 1/36 [..............................] - ETA: 0s - loss: 0.6375
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3382
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3738
36/36 [==============================] - 0s 3ms/step - loss: 0.3637
Epoch:  5
 1/36 [..............................] - ETA: 0s - loss: 0.6320
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3643
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3803
36/36 [==============================] - 0s 3ms/step - loss: 0.3706
Epoch:  6
 1/36 [..............................] - ETA: 0s - loss: 0.6491
17/36 [=============&gt;................] - ETA: 0s - loss: 0.4066
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.4022
36/36 [==============================] - 0s 3ms/step - loss: 0.3961
Epoch:  7
 1/36 [..............................] - ETA: 0s - loss: 0.6340
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3658
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3867
36/36 [==============================] - 0s 3ms/step - loss: 0.3815
Epoch:  8
 1/36 [..............................] - ETA: 0s - loss: 0.6268
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3415
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3838
36/36 [==============================] - 0s 3ms/step - loss: 0.3762
Epoch:  9
 1/36 [..............................] - ETA: 0s - loss: 0.6257
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3358
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3776
36/36 [==============================] - 0s 3ms/step - loss: 0.3689
Epoch:  10
 1/36 [..............................] - ETA: 0s - loss: 0.6385
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3400
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3746
36/36 [==============================] - 0s 3ms/step - loss: 0.3645
Epoch:  11
 1/36 [..............................] - ETA: 0s - loss: 0.6335
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3401
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3611
36/36 [==============================] - 0s 3ms/step - loss: 0.3600
Epoch:  12
 1/36 [..............................] - ETA: 0s - loss: 0.6416
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3601
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3831
36/36 [==============================] - 0s 3ms/step - loss: 0.3728
Epoch:  13
 1/36 [..............................] - ETA: 0s - loss: 0.6343
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3318
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3723
36/36 [==============================] - 0s 3ms/step - loss: 0.3633
Epoch:  14
 1/36 [..............................] - ETA: 0s - loss: 0.6394
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.3762
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.3093
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3670
36/36 [==============================] - 0s 5ms/step - loss: 0.3587
Epoch:  15
 1/36 [..............................] - ETA: 0s - loss: 0.6355
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3333
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3653
36/36 [==============================] - 0s 3ms/step - loss: 0.3579
Epoch:  16
 1/36 [..............................] - ETA: 0s - loss: 0.6293
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3378
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3715
36/36 [==============================] - 0s 3ms/step - loss: 0.3617
Epoch:  17
 1/36 [..............................] - ETA: 0s - loss: 0.6265
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3566
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3735
36/36 [==============================] - 0s 3ms/step - loss: 0.3643
Epoch:  18
 1/36 [..............................] - ETA: 0s - loss: 0.6431
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3983
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3995
36/36 [==============================] - 0s 3ms/step - loss: 0.3929
Epoch:  19
 1/36 [..............................] - ETA: 0s - loss: 0.6293
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3614
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3818
36/36 [==============================] - 0s 3ms/step - loss: 0.3768
Epoch:  20
 1/36 [..............................] - ETA: 0s - loss: 0.6226
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3382
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3735
36/36 [==============================] - 0s 3ms/step - loss: 0.3660
Epoch:  21
 1/36 [..............................] - ETA: 0s - loss: 0.6279
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3322
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3605
36/36 [==============================] - 0s 3ms/step - loss: 0.3541
Epoch:  22
 1/36 [..............................] - ETA: 0s - loss: 0.6360
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3701
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3805
36/36 [==============================] - 0s 3ms/step - loss: 0.3764
Epoch:  23
 1/36 [..............................] - ETA: 0s - loss: 0.6298
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3452
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3727
36/36 [==============================] - 0s 3ms/step - loss: 0.3630
Epoch:  24
 1/36 [..............................] - ETA: 0s - loss: 0.6233
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3380
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3556
36/36 [==============================] - 0s 3ms/step - loss: 0.3541
Epoch:  25
 1/36 [..............................] - ETA: 0s - loss: 0.6364
16/36 [============&gt;.................] - ETA: 0s - loss: 0.3893
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3744
36/36 [==============================] - 0s 3ms/step - loss: 0.3778
Epoch:  26
 1/36 [..............................] - ETA: 0s - loss: 0.6303
16/36 [============&gt;.................] - ETA: 0s - loss: 0.3694
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.3277
36/36 [==============================] - 0s 4ms/step - loss: 0.3614
Epoch:  27
 1/36 [..............................] - ETA: 0s - loss: 0.6192
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3387
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3561
36/36 [==============================] - 0s 3ms/step - loss: 0.3544
Epoch:  28
 1/36 [..............................] - ETA: 0s - loss: 0.6301
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3662
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3726
36/36 [==============================] - 0s 3ms/step - loss: 0.3685
Epoch:  29
 1/36 [..............................] - ETA: 0s - loss: 0.6195
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3359
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3557
36/36 [==============================] - 0s 3ms/step - loss: 0.3523
Epoch:  30
 1/36 [..............................] - ETA: 0s - loss: 0.6023
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3679
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3727
36/36 [==============================] - 0s 3ms/step - loss: 0.3639
Epoch:  31
 1/36 [..............................] - ETA: 0s - loss: 0.6276
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3824
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.4106
36/36 [==============================] - 0s 3ms/step - loss: 0.4013
Epoch:  32
 1/36 [..............................] - ETA: 0s - loss: 0.6290
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3631
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3723
36/36 [==============================] - 0s 3ms/step - loss: 0.3680
Epoch:  33
 1/36 [..............................] - ETA: 0s - loss: 0.6248
16/36 [============&gt;.................] - ETA: 0s - loss: 0.3520
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3390
36/36 [==============================] - 0s 3ms/step - loss: 0.3468
Epoch:  34
 1/36 [..............................] - ETA: 0s - loss: 0.6164
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3399
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3477
36/36 [==============================] - 0s 3ms/step - loss: 0.3458
Epoch:  35
 1/36 [..............................] - ETA: 0s - loss: 0.6088
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3394
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3528
36/36 [==============================] - 0s 3ms/step - loss: 0.3481
Epoch:  36
 1/36 [..............................] - ETA: 0s - loss: 0.6127
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3340
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3365
36/36 [==============================] - 0s 3ms/step - loss: 0.3381
Epoch:  37
 1/36 [..............................] - ETA: 0s - loss: 0.6093
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3439
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3339
36/36 [==============================] - 0s 3ms/step - loss: 0.3408
Epoch:  38
 1/36 [..............................] - ETA: 0s - loss: 0.6049
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3419
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3660
36/36 [==============================] - 0s 3ms/step - loss: 0.3617
Epoch:  39
 1/36 [..............................] - ETA: 0s - loss: 0.6303
17/36 [=============&gt;................] - ETA: 0s - loss: 0.5211
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.5619
36/36 [==============================] - 0s 3ms/step - loss: 0.5422
Epoch:  40
 1/36 [..............................] - ETA: 0s - loss: 0.6195
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3507
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3773
36/36 [==============================] - 0s 3ms/step - loss: 0.3724
Epoch:  41
 1/36 [..............................] - ETA: 0s - loss: 0.6189
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3245
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3617
36/36 [==============================] - 0s 3ms/step - loss: 0.3559
Epoch:  42
 1/36 [..............................] - ETA: 0s - loss: 0.6236
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3264
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3468
36/36 [==============================] - 0s 3ms/step - loss: 0.3463
Epoch:  43
 1/36 [..............................] - ETA: 0s - loss: 0.6221
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3474
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3561
36/36 [==============================] - 0s 3ms/step - loss: 0.3525
Epoch:  44
 1/36 [..............................] - ETA: 0s - loss: 0.6055
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3675
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3526
36/36 [==============================] - 0s 3ms/step - loss: 0.3517
Epoch:  45
 1/36 [..............................] - ETA: 0s - loss: 0.6062
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.3726
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.4219
36/36 [==============================] - 0s 3ms/step - loss: 0.4105
Epoch:  46
 1/36 [..............................] - ETA: 0s - loss: 0.6075
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3774
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.4017
36/36 [==============================] - 0s 3ms/step - loss: 0.3932
Epoch:  47
 1/36 [..............................] - ETA: 0s - loss: 0.6094
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3702
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3973
36/36 [==============================] - 0s 3ms/step - loss: 0.3871
Epoch:  48
 1/36 [..............................] - ETA: 0s - loss: 0.6098
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3614
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3872
36/36 [==============================] - 0s 3ms/step - loss: 0.3810
Epoch:  49
 1/36 [..............................] - ETA: 0s - loss: 0.6099
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3486
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3782
36/36 [==============================] - 0s 3ms/step - loss: 0.3732
Epoch:  50
 1/12 [=&gt;............................] - ETA: 8s
12/12 [==============================] - 1s 2ms/step

 1/36 [..............................] - ETA: 1:58 - loss: 0.7248
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6026  
34/36 [===========================&gt;..] - ETA: 0s - loss: 1.0176
36/36 [==============================] - 4s 3ms/step - loss: 1.0300
Epoch:  1
 1/36 [..............................] - ETA: 0s - loss: 0.7135
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.8785
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.8507
36/36 [==============================] - 0s 3ms/step - loss: 0.8692
Epoch:  2
 1/36 [..............................] - ETA: 0s - loss: 0.7138
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.9735
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.8140
36/36 [==============================] - 0s 3ms/step - loss: 0.8614
Epoch:  3
 1/36 [..............................] - ETA: 0s - loss: 0.7084
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.9619
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.6935
36/36 [==============================] - 0s 4ms/step - loss: 0.8500
Epoch:  4
 1/36 [..............................] - ETA: 0s - loss: 0.7107
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9220
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.8185
36/36 [==============================] - 0s 3ms/step - loss: 0.8482
Epoch:  5
 1/36 [..............................] - ETA: 0s - loss: 0.7058
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9036
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.8152
36/36 [==============================] - 0s 3ms/step - loss: 0.8435
Epoch:  6
 1/36 [..............................] - ETA: 0s - loss: 0.7069
16/36 [============&gt;.................] - ETA: 0s - loss: 0.9577
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.8002
36/36 [==============================] - 0s 3ms/step - loss: 0.8415
Epoch:  7
 1/36 [..............................] - ETA: 0s - loss: 0.7002
16/36 [============&gt;.................] - ETA: 0s - loss: 0.9350
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.7999
36/36 [==============================] - 0s 3ms/step - loss: 0.8382
Epoch:  8
 1/36 [..............................] - ETA: 0s - loss: 0.6996
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9149
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.8141
36/36 [==============================] - 0s 3ms/step - loss: 0.8284
Epoch:  9
 1/36 [..............................] - ETA: 0s - loss: 0.7002
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9266
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.7885
36/36 [==============================] - 0s 3ms/step - loss: 0.8227
Epoch:  10
 1/36 [..............................] - ETA: 0s - loss: 0.6990
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9298
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7989
36/36 [==============================] - 0s 3ms/step - loss: 0.8181
Epoch:  11
 1/36 [..............................] - ETA: 0s - loss: 0.6958
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9340
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.8016
36/36 [==============================] - 0s 3ms/step - loss: 0.8080
Epoch:  12
 1/36 [..............................] - ETA: 0s - loss: 0.6899
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9287
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.8012
36/36 [==============================] - 0s 3ms/step - loss: 0.7972
Epoch:  13
 1/36 [..............................] - ETA: 0s - loss: 0.6799
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9371
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7793
36/36 [==============================] - 0s 3ms/step - loss: 0.7380
Epoch:  14
 1/36 [..............................] - ETA: 0s - loss: 0.6619
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9590
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7833
36/36 [==============================] - 0s 3ms/step - loss: 0.7798
Epoch:  15
 1/36 [..............................] - ETA: 0s - loss: 0.6395
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9803
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7849
36/36 [==============================] - 0s 3ms/step - loss: 0.7844
Epoch:  16
 1/36 [..............................] - ETA: 0s - loss: 0.6263
17/36 [=============&gt;................] - ETA: 0s - loss: 0.9273
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.7825
36/36 [==============================] - 0s 3ms/step - loss: 0.7279
Epoch:  17
 1/36 [..............................] - ETA: 0s - loss: 0.6026
17/36 [=============&gt;................] - ETA: 0s - loss: 0.8639
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7567
36/36 [==============================] - 0s 3ms/step - loss: 0.7677
Epoch:  18
 1/36 [..............................] - ETA: 0s - loss: 0.5775
17/36 [=============&gt;................] - ETA: 0s - loss: 0.8687
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7767
36/36 [==============================] - 0s 3ms/step - loss: 0.7924
Epoch:  19
 1/36 [..............................] - ETA: 0s - loss: 0.5711
17/36 [=============&gt;................] - ETA: 0s - loss: 0.8327
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7646
36/36 [==============================] - 0s 3ms/step - loss: 0.7532
Epoch:  20
 1/36 [..............................] - ETA: 0s - loss: 0.5494
17/36 [=============&gt;................] - ETA: 0s - loss: 0.7507
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7516
36/36 [==============================] - 0s 3ms/step - loss: 0.7359
Epoch:  21
 1/36 [..............................] - ETA: 0s - loss: 0.5182
16/36 [============&gt;.................] - ETA: 0s - loss: 0.7901
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.7391
36/36 [==============================] - 0s 3ms/step - loss: 0.7257
Epoch:  22
 1/36 [..............................] - ETA: 0s - loss: 0.5004
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6979
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7164
36/36 [==============================] - 0s 3ms/step - loss: 0.6983
Epoch:  23
 1/36 [..............................] - ETA: 0s - loss: 0.4885
17/36 [=============&gt;................] - ETA: 0s - loss: 0.7953
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7302
36/36 [==============================] - 0s 3ms/step - loss: 0.7581
Epoch:  24
 1/36 [..............................] - ETA: 0s - loss: 0.4890
17/36 [=============&gt;................] - ETA: 0s - loss: 0.7794
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.7172
36/36 [==============================] - 0s 3ms/step - loss: 0.7192
Epoch:  25
 1/36 [..............................] - ETA: 0s - loss: 0.4568
17/36 [=============&gt;................] - ETA: 0s - loss: 0.7196
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.6748
36/36 [==============================] - 0s 3ms/step - loss: 0.6194
Epoch:  26
 1/36 [..............................] - ETA: 0s - loss: 0.4293
17/36 [=============&gt;................] - ETA: 0s - loss: 0.7296
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.6640
36/36 [==============================] - 0s 3ms/step - loss: 0.6451
Epoch:  27
 1/36 [..............................] - ETA: 0s - loss: 0.4037
17/36 [=============&gt;................] - ETA: 0s - loss: 0.7974
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.6785
36/36 [==============================] - 0s 3ms/step - loss: 0.6721
Epoch:  28
 1/36 [..............................] - ETA: 0s - loss: 0.3729
17/36 [=============&gt;................] - ETA: 0s - loss: 0.7555
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.5941
36/36 [==============================] - 0s 3ms/step - loss: 0.5559
Epoch:  29
 1/36 [..............................] - ETA: 0s - loss: 0.3213
17/36 [=============&gt;................] - ETA: 0s - loss: 0.8689
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.5752
36/36 [==============================] - 0s 3ms/step - loss: 0.5554
Epoch:  30
 1/36 [..............................] - ETA: 0s - loss: 0.2320
17/36 [=============&gt;................] - ETA: 0s - loss: 0.5754
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.7658
36/36 [==============================] - 0s 3ms/step - loss: 0.7406
Epoch:  31
 1/36 [..............................] - ETA: 0s - loss: 0.2426
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.8147
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.6970
36/36 [==============================] - 0s 3ms/step - loss: 0.6872
Epoch:  32
 1/36 [..............................] - ETA: 0s - loss: 0.1988
17/36 [=============&gt;................] - ETA: 0s - loss: 1.0346
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.8468
36/36 [==============================] - 0s 3ms/step - loss: 0.8704
Epoch:  33
 1/36 [..............................] - ETA: 0s - loss: 0.1989
16/36 [============&gt;.................] - ETA: 0s - loss: 0.7587
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.8244
36/36 [==============================] - 0s 3ms/step - loss: 0.9096
Epoch:  34
 1/36 [..............................] - ETA: 0s - loss: 0.1415
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3925
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7331
36/36 [==============================] - 0s 3ms/step - loss: 0.7041
Epoch:  35
 1/36 [..............................] - ETA: 0s - loss: 0.2047
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6671
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.9414
36/36 [==============================] - 0s 3ms/step - loss: 0.9982
Epoch:  36
 1/36 [..............................] - ETA: 0s - loss: 0.2246
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6411
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.7844
36/36 [==============================] - 0s 3ms/step - loss: 0.8466
Epoch:  37
 1/36 [..............................] - ETA: 0s - loss: 0.2275
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.6330
35/36 [============================&gt;.] - ETA: 0s - loss: 0.8217
36/36 [==============================] - 0s 3ms/step - loss: 0.8370
Epoch:  38
 1/36 [..............................] - ETA: 0s - loss: 0.2047
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6594
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.7459
36/36 [==============================] - 0s 3ms/step - loss: 0.8321
Epoch:  39
 1/36 [..............................] - ETA: 0s - loss: 0.1733
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6443
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.6580
36/36 [==============================] - 0s 3ms/step - loss: 0.6522
Epoch:  40
 1/36 [..............................] - ETA: 0s - loss: 0.1142
17/36 [=============&gt;................] - ETA: 0s - loss: 0.7031
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.7977
36/36 [==============================] - 0s 3ms/step - loss: 0.8732
Epoch:  41
 1/36 [..............................] - ETA: 0s - loss: 0.0621
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6803
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.7751
36/36 [==============================] - 0s 3ms/step - loss: 0.8093
Epoch:  42
 1/36 [..............................] - ETA: 0s - loss: 0.0195
16/36 [============&gt;.................] - ETA: 0s - loss: 0.6962
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.7188
36/36 [==============================] - 0s 3ms/step - loss: 0.7990
Epoch:  43
 1/36 [..............................] - ETA: 0s - loss: 0.0544
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.5680
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.8015
36/36 [==============================] - 0s 3ms/step - loss: 0.7780
Epoch:  44
 1/36 [..............................] - ETA: 0s - loss: 0.0039
16/36 [============&gt;.................] - ETA: 0s - loss: 0.5144
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.7611
36/36 [==============================] - 0s 3ms/step - loss: 0.7174
Epoch:  45
 1/36 [..............................] - ETA: 0s - loss: 0.1372
17/36 [=============&gt;................] - ETA: 0s - loss: 0.5956
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.7304
36/36 [==============================] - 0s 3ms/step - loss: 0.7017
Epoch:  46
 1/36 [..............................] - ETA: 0s - loss: 0.1300
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.7374
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.6977
36/36 [==============================] - 0s 4ms/step - loss: 0.6134
Epoch:  47
 1/36 [..............................] - ETA: 0s - loss: 0.0946
16/36 [============&gt;.................] - ETA: 0s - loss: 0.6078
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.6501
36/36 [==============================] - 0s 3ms/step - loss: 0.6575
Epoch:  48
 1/36 [..............................] - ETA: 0s - loss: 0.0373
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6315
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.6516
36/36 [==============================] - 0s 3ms/step - loss: 0.6352
Epoch:  49
 1/36 [..............................] - ETA: 0s - loss: 0.0461
16/36 [============&gt;.................] - ETA: 0s - loss: 0.5675
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.6293
36/36 [==============================] - 0s 3ms/step - loss: 0.5749
Epoch:  50
 1/12 [=&gt;............................] - ETA: 8s
12/12 [==============================] - 1s 2ms/step</code></pre>
</div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-28_75b0582a88df80c52ee3ae3aa1e85efc">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>sample_predictions_lstm_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Rolling origin forecast resampling 
# A tibble: 3 × 3
  splits          id     predict            
  &lt;list&gt;          &lt;chr&gt;  &lt;list&gt;             
1 &lt;split [48/12]&gt; Slice1 &lt;tbl_time [72 × 3]&gt;
2 &lt;split [48/12]&gt; Slice2 &lt;tbl_time [72 × 3]&gt;
3 &lt;split [48/12]&gt; Slice3 &lt;tbl_time [72 × 3]&gt;</code></pre>
</div>
</div>
</section>
<section id="assessing-the-backtested-performance" class="level3">
<h3 class="anchored" data-anchor-id="assessing-the-backtested-performance">Assessing The Backtested Performance</h3>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-29_2cbe91aee6ebfc94eef391a61a7e730f">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>sample_rmse_tbl <span class="ot">&lt;-</span> sample_predictions_lstm_tbl <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rmse =</span> <span class="fu">map_df</span>(predict, calc_rmse)) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(id, rmse) </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>sample_rmse_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  id     rmse$.estimate
  &lt;chr&gt;           &lt;dbl&gt;
1 Slice1           2.60
2 Slice2          15.6 
3 Slice3          24.9 </code></pre>
</div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-30_6e9136c2929aefe62a6d99e921ff202f">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>sample_rmse_tbl <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(rmse<span class="sc">$</span>.estimate)) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">fill =</span> <span class="fu">palette_light</span>()[[<span class="dv">1</span>]], <span class="at">bins =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="fu">palette_light</span>()[[<span class="dv">1</span>]], <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_tq</span>() <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Histogram of RMSE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelo_sltm_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-31_4638774763955ce49112e086357c87a6">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>sample_rmse_tbl<span class="sc">$</span>rmse <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_rmse =</span> <span class="fu">mean</span>(.estimate),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd_rmse   =</span> <span class="fu">sd</span>(.estimate)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  mean_rmse sd_rmse
      &lt;dbl&gt;   &lt;dbl&gt;
1      14.4    11.2</code></pre>
</div>
</div>
<p>Visualizing The Backtest Results</p>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-32_f4874b5a278536e473389ca466ba88f7">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>plot_predictions <span class="ot">&lt;-</span> <span class="cf">function</span>(sampling_tbl, predictions_col, </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">base_size =</span> <span class="dv">14</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">title =</span> <span class="st">"Backtested Predictions"</span>) {</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    predictions_col_expr <span class="ot">&lt;-</span> <span class="fu">enquo</span>(predictions_col)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map plot_split() to sampling_tbl</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    sampling_tbl_with_plots <span class="ot">&lt;-</span> sampling_tbl <span class="sc">%&gt;%</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">gg_plots =</span> <span class="fu">map2</span>(<span class="sc">!!</span> predictions_col_expr, id, </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">.f        =</span> plot_prediction, </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">alpha     =</span> alpha, </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">size      =</span> size, </span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">base_size =</span> base_size)) </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make plots with cowplot</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    plot_list <span class="ot">&lt;-</span> sampling_tbl_with_plots<span class="sc">$</span>gg_plots </span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    p_temp <span class="ot">&lt;-</span> plot_list[[<span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    legend <span class="ot">&lt;-</span> <span class="fu">get_legend</span>(p_temp)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    p_body  <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plot_list, <span class="at">ncol =</span> ncol)</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    p_title <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span> </span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">draw_label</span>(title, <span class="at">size =</span> <span class="dv">18</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">colour =</span> <span class="fu">palette_light</span>()[[<span class="dv">1</span>]])</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(p_title, p_body, legend, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="dv">1</span>, <span class="fl">0.05</span>))</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(g)</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-33_0172eec3c3506dfa6396b4d7cbc702cd">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>sample_predictions_lstm_tbl <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_predictions</span>(<span class="at">predictions_col =</span> predict, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">title =</span> <span class="st">"Keras Stateful LSTM: Backtested Predictions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelo_sltm_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
</section>
<section id="predicting-the-next-10-years" class="level3">
<h3 class="anchored" data-anchor-id="predicting-the-next-10-years">Predicting The Next 10 Years</h3>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-34_0498861ce729040b974a563ad5a04876">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>predict_keras_lstm_future <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">epochs =</span> <span class="dv">300</span>, ...) {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    lstm_prediction <span class="ot">&lt;-</span> <span class="cf">function</span>(data, epochs, ...) {</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.2 Data Setup (MODIFIED)</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        df <span class="ot">&lt;-</span> data</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.3 Preprocessing</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>        rec_obj <span class="ot">&lt;-</span> <span class="fu">recipe</span>(value <span class="sc">~</span> ., df) <span class="sc">%&gt;%</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">step_sqrt</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">step_center</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">step_scale</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prep</span>()</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>        df_processed_tbl <span class="ot">&lt;-</span> <span class="fu">bake</span>(rec_obj, df)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        center_history <span class="ot">&lt;-</span> rec_obj<span class="sc">$</span>steps[[<span class="dv">2</span>]]<span class="sc">$</span>means[<span class="st">"value"</span>]</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        scale_history  <span class="ot">&lt;-</span> rec_obj<span class="sc">$</span>steps[[<span class="dv">3</span>]]<span class="sc">$</span>sds[<span class="st">"value"</span>]</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.4 LSTM Plan</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        lag_setting  <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="co"># = nrow(df_tst)</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>        batch_size   <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>        train_length <span class="ot">&lt;-</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">3</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>        tsteps       <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>        epochs       <span class="ot">&lt;-</span> epochs</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.5 Train Setup (MODIFIED)</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>        lag_train_tbl <span class="ot">&lt;-</span> df_processed_tbl <span class="sc">%&gt;%</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">value_lag =</span> <span class="fu">lag</span>(value, <span class="at">n =</span> lag_setting)) <span class="sc">%&gt;%</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value_lag)) <span class="sc">%&gt;%</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tail</span>(train_length)</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>        x_train_vec <span class="ot">&lt;-</span> lag_train_tbl<span class="sc">$</span>value_lag</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>        x_train_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> x_train_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(x_train_vec), <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>        y_train_vec <span class="ot">&lt;-</span> lag_train_tbl<span class="sc">$</span>value</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>        y_train_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> y_train_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(y_train_vec), <span class="dv">1</span>))</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>        x_test_vec <span class="ot">&lt;-</span> y_train_vec <span class="sc">%&gt;%</span> <span class="fu">tail</span>(lag_setting)</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>        x_test_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> x_test_vec, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(x_test_vec), <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.6 LSTM Model</span></span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>        model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>        model <span class="sc">%&gt;%</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>            <span class="fu">layer_lstm</span>(<span class="at">units            =</span> <span class="dv">50</span>, </span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>                       <span class="at">input_shape      =</span> <span class="fu">c</span>(tsteps, <span class="dv">1</span>), </span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>                       <span class="at">batch_size       =</span> batch_size,</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>                       <span class="at">return_sequences =</span> <span class="cn">TRUE</span>, </span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stateful         =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>            <span class="fu">layer_lstm</span>(<span class="at">units            =</span> <span class="dv">50</span>, </span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>                       <span class="at">return_sequences =</span> <span class="cn">FALSE</span>, </span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stateful         =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>)</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>        model <span class="sc">%&gt;%</span> </span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>            <span class="fu">compile</span>(<span class="at">loss =</span> <span class="st">'mae'</span>, <span class="at">optimizer =</span> <span class="st">'adam'</span>)</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.7 Fitting LSTM</span></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>epochs) {</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>            model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(<span class="at">x          =</span> x_train_arr, </span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y          =</span> y_train_arr, </span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>                          <span class="at">batch_size =</span> batch_size,</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>                          <span class="at">epochs     =</span> <span class="dv">1</span>, </span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>                          <span class="at">verbose    =</span> <span class="dv">1</span>, </span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>                          <span class="at">shuffle    =</span> <span class="cn">FALSE</span>)</span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>            model <span class="sc">%&gt;%</span> <span class="fu">reset_states</span>()</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">"Epoch: "</span>, i)</span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5.1.8 Predict and Return Tidy Data (MODIFIED)</span></span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make Predictions</span></span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>        pred_out <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> </span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a>            <span class="fu">predict</span>(x_test_arr, <span class="at">batch_size =</span> batch_size) <span class="sc">%&gt;%</span></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a>            .[,<span class="dv">1</span>] </span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make future index using tk_make_future_timeseries()</span></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a>        idx <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tk_index</span>() <span class="sc">%&gt;%</span></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tk_make_future_timeseries</span>(<span class="at">length_out =</span> lag_setting)</span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retransform values</span></span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>        pred_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>            <span class="at">index   =</span> idx,</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a>            <span class="at">value   =</span> (pred_out <span class="sc">*</span> scale_history <span class="sc">+</span> center_history)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Combine actual data with predictions</span></span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>        tbl_1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a>            <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"actual"</span>)</span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>        tbl_3 <span class="ot">&lt;-</span> pred_tbl <span class="sc">%&gt;%</span></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a>            <span class="fu">add_column</span>(<span class="at">key =</span> <span class="st">"predict"</span>)</span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create time_bind_rows() to solve dplyr issue</span></span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a>        time_bind_rows <span class="ot">&lt;-</span> <span class="cf">function</span>(data_1, data_2, index) {</span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>            index_expr <span class="ot">&lt;-</span> <span class="fu">enquo</span>(index)</span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>            <span class="fu">bind_rows</span>(data_1, data_2) <span class="sc">%&gt;%</span></span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as_tbl_time</span>(<span class="at">index =</span> <span class="sc">!!</span> index_expr)</span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a>        ret <span class="ot">&lt;-</span> <span class="fu">list</span>(tbl_1, tbl_3) <span class="sc">%&gt;%</span></span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a>            <span class="fu">reduce</span>(time_bind_rows, <span class="at">index =</span> index) <span class="sc">%&gt;%</span></span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>            <span class="fu">arrange</span>(key, index) <span class="sc">%&gt;%</span></span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">key =</span> <span class="fu">as_factor</span>(key))</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(ret)</span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a>    safe_lstm <span class="ot">&lt;-</span> <span class="fu">possibly</span>(lstm_prediction, <span class="at">otherwise =</span> <span class="cn">NA</span>)</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">safe_lstm</span>(data, epochs, ...)</span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-35_ce96c8508f34e7635cfa52ec37e64a7c">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>future_gold_ts_tbl <span class="ot">&lt;-</span> <span class="fu">predict_keras_lstm_future</span>(gold_mean, <span class="at">epochs =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1/36 [..............................] - ETA: 2:00 - loss: 1.5409
17/36 [=============&gt;................] - ETA: 0s - loss: 0.8848  
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.8329
36/36 [==============================] - 4s 3ms/step - loss: 0.7856
Epoch:  1
 1/36 [..............................] - ETA: 0s - loss: 1.4715
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6275
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.5144
36/36 [==============================] - 0s 3ms/step - loss: 0.5007
Epoch:  2
 1/36 [..............................] - ETA: 0s - loss: 1.4297
17/36 [=============&gt;................] - ETA: 0s - loss: 0.6316
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.5545
36/36 [==============================] - 0s 3ms/step - loss: 0.5638
Epoch:  3
 1/36 [..............................] - ETA: 0s - loss: 1.4154
16/36 [============&gt;.................] - ETA: 0s - loss: 0.5522
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.4461
36/36 [==============================] - 0s 3ms/step - loss: 0.4206
Epoch:  4
 1/36 [..............................] - ETA: 0s - loss: 1.3582
17/36 [=============&gt;................] - ETA: 0s - loss: 0.5188
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.4561
36/36 [==============================] - 0s 3ms/step - loss: 0.4538
Epoch:  5
 1/36 [..............................] - ETA: 0s - loss: 1.3433
16/36 [============&gt;.................] - ETA: 0s - loss: 0.4306
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3802
36/36 [==============================] - 0s 3ms/step - loss: 0.3850
Epoch:  6
 1/36 [..............................] - ETA: 0s - loss: 1.3144
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3556
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3484
36/36 [==============================] - 0s 3ms/step - loss: 0.3559
Epoch:  7
 1/36 [..............................] - ETA: 0s - loss: 1.2928
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3348
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3363
36/36 [==============================] - 0s 3ms/step - loss: 0.3399
Epoch:  8
 1/36 [..............................] - ETA: 0s - loss: 1.2721
16/36 [============&gt;.................] - ETA: 0s - loss: 0.3567
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3397
36/36 [==============================] - 0s 3ms/step - loss: 0.3452
Epoch:  9
 1/36 [..............................] - ETA: 0s - loss: 1.2557
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3153
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3258
36/36 [==============================] - 0s 3ms/step - loss: 0.3302
Epoch:  10
 1/36 [..............................] - ETA: 0s - loss: 1.2317
17/36 [=============&gt;................] - ETA: 0s - loss: 0.3171
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3287
36/36 [==============================] - 0s 3ms/step - loss: 0.3344
Epoch:  11
 1/36 [..............................] - ETA: 0s - loss: 1.2119
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2980
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3131
36/36 [==============================] - 0s 3ms/step - loss: 0.3201
Epoch:  12
 1/36 [..............................] - ETA: 0s - loss: 1.1835
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2962
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.3125
36/36 [==============================] - 0s 3ms/step - loss: 0.3218
Epoch:  13
 1/36 [..............................] - ETA: 0s - loss: 1.1617
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2776
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3071
36/36 [==============================] - 0s 3ms/step - loss: 0.3078
Epoch:  14
 1/36 [..............................] - ETA: 0s - loss: 1.1294
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2742
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.3018
36/36 [==============================] - 0s 3ms/step - loss: 0.3060
Epoch:  15
 1/36 [..............................] - ETA: 0s - loss: 1.1065
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2717
35/36 [============================&gt;.] - ETA: 0s - loss: 0.3008
36/36 [==============================] - 0s 3ms/step - loss: 0.3023
Epoch:  16
 1/36 [..............................] - ETA: 0s - loss: 1.0814
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2645
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2973
36/36 [==============================] - 0s 3ms/step - loss: 0.2990
Epoch:  17
 1/36 [..............................] - ETA: 0s - loss: 1.0543
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2488
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2901
36/36 [==============================] - 0s 3ms/step - loss: 0.2961
Epoch:  18
 1/36 [..............................] - ETA: 0s - loss: 1.0249
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2413
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2830
36/36 [==============================] - 0s 3ms/step - loss: 0.2934
Epoch:  19
 1/36 [..............................] - ETA: 0s - loss: 0.9936
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2343
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2787
36/36 [==============================] - 0s 3ms/step - loss: 0.2891
Epoch:  20
 1/36 [..............................] - ETA: 0s - loss: 0.9598
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2333
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.3035
36/36 [==============================] - 0s 3ms/step - loss: 0.3090
Epoch:  21
 1/36 [..............................] - ETA: 0s - loss: 0.9158
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2351
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2852
36/36 [==============================] - 0s 3ms/step - loss: 0.2942
Epoch:  22
 1/36 [..............................] - ETA: 0s - loss: 0.8915
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1969
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2675
36/36 [==============================] - 0s 3ms/step - loss: 0.2785
Epoch:  23
 1/36 [..............................] - ETA: 0s - loss: 0.8509
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1880
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2634
36/36 [==============================] - 0s 3ms/step - loss: 0.2748
Epoch:  24
 1/36 [..............................] - ETA: 0s - loss: 0.8066
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1789
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2588
36/36 [==============================] - 0s 3ms/step - loss: 0.2705
Epoch:  25
 1/36 [..............................] - ETA: 0s - loss: 0.7590
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1687
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2533
36/36 [==============================] - 0s 3ms/step - loss: 0.2651
Epoch:  26
 1/36 [..............................] - ETA: 0s - loss: 0.7069
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1512
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2417
36/36 [==============================] - 0s 3ms/step - loss: 0.2519
Epoch:  27
 1/36 [..............................] - ETA: 0s - loss: 0.6650
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1758
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2500
36/36 [==============================] - 0s 3ms/step - loss: 0.2537
Epoch:  28
 1/36 [..............................] - ETA: 0s - loss: 0.6035
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1433
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2342
36/36 [==============================] - 0s 3ms/step - loss: 0.2421
Epoch:  29
 1/36 [..............................] - ETA: 0s - loss: 0.6087
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1638
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2413
36/36 [==============================] - 0s 3ms/step - loss: 0.2598
Epoch:  30
 1/36 [..............................] - ETA: 0s - loss: 0.5576
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1232
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2168
36/36 [==============================] - 0s 3ms/step - loss: 0.2171
Epoch:  31
 1/36 [..............................] - ETA: 0s - loss: 0.4852
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1740
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2436
36/36 [==============================] - 0s 3ms/step - loss: 0.2491
Epoch:  32
 1/36 [..............................] - ETA: 0s - loss: 0.5447
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1510
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2323
36/36 [==============================] - 0s 3ms/step - loss: 0.2357
Epoch:  33
 1/36 [..............................] - ETA: 0s - loss: 0.4692
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1245
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2208
36/36 [==============================] - 0s 3ms/step - loss: 0.2217
Epoch:  34
 1/36 [..............................] - ETA: 0s - loss: 0.3938
17/36 [=============&gt;................] - ETA: 0s - loss: 0.2067
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2755
36/36 [==============================] - 0s 3ms/step - loss: 0.2785
Epoch:  35
 1/36 [..............................] - ETA: 0s - loss: 0.4861
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1641
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2403
36/36 [==============================] - 0s 3ms/step - loss: 0.2401
Epoch:  36
 1/36 [..............................] - ETA: 0s - loss: 0.3228
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.2095
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2697
36/36 [==============================] - 0s 3ms/step - loss: 0.2743
Epoch:  37
 1/36 [..............................] - ETA: 0s - loss: 0.3780
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1483
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2301
36/36 [==============================] - 0s 3ms/step - loss: 0.2449
Epoch:  38
 1/36 [..............................] - ETA: 0s - loss: 0.3149
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1441
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2296
36/36 [==============================] - 0s 3ms/step - loss: 0.2329
Epoch:  39
 1/36 [..............................] - ETA: 0s - loss: 0.2753
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1367
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2293
36/36 [==============================] - 0s 3ms/step - loss: 0.2368
Epoch:  40
 1/36 [..............................] - ETA: 0s - loss: 0.2480
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1217
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2198
36/36 [==============================] - 0s 3ms/step - loss: 0.2257
Epoch:  41
 1/36 [..............................] - ETA: 0s - loss: 0.2056
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1177
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2165
36/36 [==============================] - 0s 3ms/step - loss: 0.2210
Epoch:  42
 1/36 [..............................] - ETA: 0s - loss: 0.1968
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1282
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2209
36/36 [==============================] - 0s 3ms/step - loss: 0.2221
Epoch:  43
 1/36 [..............................] - ETA: 0s - loss: 0.1159
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1028
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2126
36/36 [==============================] - 0s 3ms/step - loss: 0.2114
Epoch:  44
 1/36 [..............................] - ETA: 0s - loss: 0.0685
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1887
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2629
36/36 [==============================] - 0s 3ms/step - loss: 0.2661
Epoch:  45
 1/36 [..............................] - ETA: 0s - loss: 0.1374
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1302
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1971
36/36 [==============================] - 0s 4ms/step - loss: 0.2261
Epoch:  46
 1/36 [..............................] - ETA: 0s - loss: 0.0310
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1639
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2395
36/36 [==============================] - 0s 3ms/step - loss: 0.2421
Epoch:  47
 1/36 [..............................] - ETA: 0s - loss: 0.1023
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1267
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2225
36/36 [==============================] - 0s 3ms/step - loss: 0.2222
Epoch:  48
 1/36 [..............................] - ETA: 0s - loss: 0.0448
17/36 [=============&gt;................] - ETA: 0s - loss: 0.0946
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2078
36/36 [==============================] - 0s 3ms/step - loss: 0.2082
Epoch:  49
 1/36 [..............................] - ETA: 0s - loss: 0.1060
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1609
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.2255
36/36 [==============================] - 0s 4ms/step - loss: 0.2337
Epoch:  50
 1/36 [..............................] - ETA: 0s - loss: 0.0495
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1174
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2074
36/36 [==============================] - 0s 3ms/step - loss: 0.2118
Epoch:  51
 1/36 [..............................] - ETA: 0s - loss: 0.0684
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1307
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.2016
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2128
36/36 [==============================] - 0s 5ms/step - loss: 0.2109
Epoch:  52
 1/36 [..............................] - ETA: 0s - loss: 0.0577
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1130
35/36 [============================&gt;.] - ETA: 0s - loss: 0.1984
36/36 [==============================] - 0s 3ms/step - loss: 0.1972
Epoch:  53
 1/36 [..............................] - ETA: 0s - loss: 0.0913
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1355
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2148
36/36 [==============================] - 0s 3ms/step - loss: 0.2043
Epoch:  54
 1/36 [..............................] - ETA: 0s - loss: 0.0441
16/36 [============&gt;.................] - ETA: 0s - loss: 0.0875
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.1949
36/36 [==============================] - 0s 3ms/step - loss: 0.1889
Epoch:  55
 1/36 [..............................] - ETA: 0s - loss: 0.0178
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.0898
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1895
36/36 [==============================] - 0s 3ms/step - loss: 0.1814
Epoch:  56
 1/36 [..............................] - ETA: 0s - loss: 0.0342
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1094
35/36 [============================&gt;.] - ETA: 0s - loss: 0.1895
36/36 [==============================] - 0s 3ms/step - loss: 0.1854
Epoch:  57
 1/36 [..............................] - ETA: 0s - loss: 0.0715
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1149
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2186
36/36 [==============================] - 0s 3ms/step - loss: 0.2226
Epoch:  58
 1/36 [..............................] - ETA: 0s - loss: 0.1127
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1688
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2490
36/36 [==============================] - 0s 3ms/step - loss: 0.2721
Epoch:  59
 1/36 [..............................] - ETA: 0s - loss: 0.0523
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1261
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2306
36/36 [==============================] - 0s 3ms/step - loss: 0.2351
Epoch:  60
 1/36 [..............................] - ETA: 0s - loss: 0.0351
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1008
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2226
36/36 [==============================] - 0s 3ms/step - loss: 0.2295
Epoch:  61
 1/36 [..............................] - ETA: 0s - loss: 0.0293
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1176
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2260
36/36 [==============================] - 0s 3ms/step - loss: 0.2407
Epoch:  62
 1/36 [..............................] - ETA: 0s - loss: 0.0098
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1016
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2185
36/36 [==============================] - 0s 3ms/step - loss: 0.2337
Epoch:  63
 1/36 [..............................] - ETA: 0s - loss: 0.0270
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1062
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2185
36/36 [==============================] - 0s 3ms/step - loss: 0.2320
Epoch:  64
 1/36 [..............................] - ETA: 0s - loss: 0.0335
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1082
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.2010
36/36 [==============================] - 0s 3ms/step - loss: 0.2323
Epoch:  65
 1/36 [..............................] - ETA: 0s - loss: 0.0031
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1119
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2183
36/36 [==============================] - 0s 3ms/step - loss: 0.2295
Epoch:  66
 1/36 [..............................] - ETA: 0s - loss: 0.0601
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1121
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2276
36/36 [==============================] - 0s 3ms/step - loss: 0.2346
Epoch:  67
 1/36 [..............................] - ETA: 0s - loss: 0.0256
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1181
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2167
36/36 [==============================] - 0s 3ms/step - loss: 0.2344
Epoch:  68
 1/36 [..............................] - ETA: 0s - loss: 0.0485
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1029
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1985
36/36 [==============================] - 0s 4ms/step - loss: 0.2330
Epoch:  69
 1/36 [..............................] - ETA: 0s - loss: 0.0363
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1178
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2195
36/36 [==============================] - 0s 3ms/step - loss: 0.2292
Epoch:  70
 1/36 [..............................] - ETA: 0s - loss: 0.0582
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1129
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2239
36/36 [==============================] - 0s 3ms/step - loss: 0.2392
Epoch:  71
 1/36 [..............................] - ETA: 0s - loss: 0.0468
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1313
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2268
36/36 [==============================] - 0s 3ms/step - loss: 0.2303
Epoch:  72
 1/36 [..............................] - ETA: 0s - loss: 0.0458
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1083
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2251
36/36 [==============================] - 0s 3ms/step - loss: 0.2321
Epoch:  73
 1/36 [..............................] - ETA: 0s - loss: 0.0382
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1171
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2216
36/36 [==============================] - 0s 3ms/step - loss: 0.2334
Epoch:  74
 1/36 [..............................] - ETA: 0s - loss: 0.0365
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1104
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2240
36/36 [==============================] - 0s 3ms/step - loss: 0.2300
Epoch:  75
 1/36 [..............................] - ETA: 0s - loss: 0.0015
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1044
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2162
36/36 [==============================] - 0s 3ms/step - loss: 0.2291
Epoch:  76
 1/36 [..............................] - ETA: 0s - loss: 0.0147
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1168
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2180
36/36 [==============================] - 0s 3ms/step - loss: 0.2271
Epoch:  77
 1/36 [..............................] - ETA: 0s - loss: 0.0111
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1099
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2146
36/36 [==============================] - 0s 3ms/step - loss: 0.2361
Epoch:  78
 1/36 [..............................] - ETA: 0s - loss: 0.0938
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1170
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2200
36/36 [==============================] - 0s 3ms/step - loss: 0.2303
Epoch:  79
 1/36 [..............................] - ETA: 0s - loss: 0.0019
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1109
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2173
36/36 [==============================] - 0s 3ms/step - loss: 0.2286
Epoch:  80
 1/36 [..............................] - ETA: 0s - loss: 0.0181
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1298
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2235
36/36 [==============================] - 0s 3ms/step - loss: 0.2289
Epoch:  81
 1/36 [..............................] - ETA: 0s - loss: 0.0202
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1126
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.2020
36/36 [==============================] - 0s 3ms/step - loss: 0.2328
Epoch:  82
 1/36 [..............................] - ETA: 0s - loss: 0.0240
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1142
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2117
36/36 [==============================] - 0s 3ms/step - loss: 0.2259
Epoch:  83
 1/36 [..............................] - ETA: 0s - loss: 0.0202
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1125
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2186
36/36 [==============================] - 0s 3ms/step - loss: 0.2301
Epoch:  84
 1/36 [..............................] - ETA: 0s - loss: 0.0679
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1202
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2259
36/36 [==============================] - 0s 3ms/step - loss: 0.2307
Epoch:  85
 1/36 [..............................] - ETA: 0s - loss: 0.0095
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1041
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2159
36/36 [==============================] - 0s 3ms/step - loss: 0.2287
Epoch:  86
 1/36 [..............................] - ETA: 0s - loss: 0.0762
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1223
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2135
36/36 [==============================] - 0s 3ms/step - loss: 0.2249
Epoch:  87
 1/36 [..............................] - ETA: 0s - loss: 0.0209
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1139
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2214
36/36 [==============================] - 0s 3ms/step - loss: 0.2345
Epoch:  88
 1/36 [..............................] - ETA: 0s - loss: 0.0843
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1148
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2213
36/36 [==============================] - 0s 3ms/step - loss: 0.2251
Epoch:  89
 1/36 [..............................] - ETA: 0s - loss: 0.0110
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1092
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2158
36/36 [==============================] - 0s 3ms/step - loss: 0.2262
Epoch:  90
 1/36 [..............................] - ETA: 0s - loss: 0.0736
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1227
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2198
36/36 [==============================] - 0s 3ms/step - loss: 0.2275
Epoch:  91
 1/36 [..............................] - ETA: 0s - loss: 0.0071
16/36 [============&gt;.................] - ETA: 0s - loss: 0.0994
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2082
36/36 [==============================] - 0s 3ms/step - loss: 0.2261
Epoch:  92
 1/36 [..............................] - ETA: 0s - loss: 0.0801
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1186
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2127
36/36 [==============================] - 0s 3ms/step - loss: 0.2259
Epoch:  93
 1/36 [..............................] - ETA: 0s - loss: 2.9087e-05
17/36 [=============&gt;................] - ETA: 0s - loss: 0.0973    
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2124
36/36 [==============================] - 0s 3ms/step - loss: 0.2247
Epoch:  94
 1/36 [..............................] - ETA: 0s - loss: 0.0191
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1243
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2140
36/36 [==============================] - 0s 3ms/step - loss: 0.2160
Epoch:  95
 1/36 [..............................] - ETA: 0s - loss: 0.0149
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1265
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2165
36/36 [==============================] - 0s 3ms/step - loss: 0.2191
Epoch:  96
 1/36 [..............................] - ETA: 0s - loss: 0.0712
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1193
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2150
36/36 [==============================] - 0s 3ms/step - loss: 0.2183
Epoch:  97
 1/36 [..............................] - ETA: 0s - loss: 0.0120
17/36 [=============&gt;................] - ETA: 0s - loss: 0.0963
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2083
36/36 [==============================] - 0s 3ms/step - loss: 0.2093
Epoch:  98
 1/36 [..............................] - ETA: 0s - loss: 0.0383
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1402
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2296
36/36 [==============================] - 0s 3ms/step - loss: 0.2332
Epoch:  99
 1/36 [..............................] - ETA: 0s - loss: 0.0696
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1232
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2159
36/36 [==============================] - 0s 3ms/step - loss: 0.2180
Epoch:  100
 1/36 [..............................] - ETA: 0s - loss: 0.1008
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1495
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2374
36/36 [==============================] - 0s 3ms/step - loss: 0.2625
Epoch:  101
 1/36 [..............................] - ETA: 0s - loss: 0.0550
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1035
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2142
36/36 [==============================] - 0s 3ms/step - loss: 0.2245
Epoch:  102
 1/36 [..............................] - ETA: 0s - loss: 0.0719
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1297
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2307
36/36 [==============================] - 0s 3ms/step - loss: 0.2447
Epoch:  103
 1/36 [..............................] - ETA: 0s - loss: 0.0322
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1072
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2250
36/36 [==============================] - 0s 3ms/step - loss: 0.2322
Epoch:  104
 1/36 [..............................] - ETA: 0s - loss: 0.0296
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1083
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2188
36/36 [==============================] - 0s 3ms/step - loss: 0.2321
Epoch:  105
 1/36 [..............................] - ETA: 0s - loss: 0.0109
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1283
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2257
36/36 [==============================] - 0s 3ms/step - loss: 0.2294
Epoch:  106
 1/36 [..............................] - ETA: 0s - loss: 0.0554
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1155
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2197
36/36 [==============================] - 0s 3ms/step - loss: 0.2311
Epoch:  107
 1/36 [..............................] - ETA: 0s - loss: 0.0140
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1046
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2170
36/36 [==============================] - 0s 3ms/step - loss: 0.2309
Epoch:  108
 1/36 [..............................] - ETA: 0s - loss: 0.0726
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1199
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2239
36/36 [==============================] - 0s 3ms/step - loss: 0.2282
Epoch:  109
 1/36 [..............................] - ETA: 0s - loss: 0.0230
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1142
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2225
36/36 [==============================] - 0s 3ms/step - loss: 0.2367
Epoch:  110
 1/36 [..............................] - ETA: 0s - loss: 0.0804
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1160
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2187
36/36 [==============================] - 0s 3ms/step - loss: 0.2290
Epoch:  111
 1/36 [..............................] - ETA: 0s - loss: 0.0137
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1099
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2239
36/36 [==============================] - 0s 3ms/step - loss: 0.2304
Epoch:  112
 1/36 [..............................] - ETA: 0s - loss: 0.0705
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1319
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2260
36/36 [==============================] - 0s 3ms/step - loss: 0.2295
Epoch:  113
 1/36 [..............................] - ETA: 0s - loss: 0.0061
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1147
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2201
36/36 [==============================] - 0s 3ms/step - loss: 0.2324
Epoch:  114
 1/36 [..............................] - ETA: 0s - loss: 0.0443
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1068
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2113
36/36 [==============================] - 0s 3ms/step - loss: 0.2296
Epoch:  115
 1/36 [..............................] - ETA: 0s - loss: 0.0021
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1047
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2151
36/36 [==============================] - 0s 3ms/step - loss: 0.2276
Epoch:  116
 1/36 [..............................] - ETA: 0s - loss: 0.0405
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1111
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2111
36/36 [==============================] - 0s 3ms/step - loss: 0.2270
Epoch:  117
 1/36 [..............................] - ETA: 0s - loss: 0.0282
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1261
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2260
36/36 [==============================] - 0s 3ms/step - loss: 0.2302
Epoch:  118
 1/36 [..............................] - ETA: 0s - loss: 0.0583
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1266
29/36 [=======================&gt;......] - ETA: 0s - loss: 0.1879
36/36 [==============================] - 0s 4ms/step - loss: 0.2263
Epoch:  119
 1/36 [..............................] - ETA: 0s - loss: 0.0396
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1242
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.1872
36/36 [==============================] - 0s 4ms/step - loss: 0.2365
Epoch:  120
 1/36 [..............................] - ETA: 0s - loss: 0.0661
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1169
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2178
36/36 [==============================] - 0s 3ms/step - loss: 0.2273
Epoch:  121
 1/36 [..............................] - ETA: 0s - loss: 0.0300
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1141
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2188
36/36 [==============================] - 0s 3ms/step - loss: 0.2303
Epoch:  122
 1/36 [..............................] - ETA: 0s - loss: 0.0562
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1366
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2271
36/36 [==============================] - 0s 3ms/step - loss: 0.2303
Epoch:  123
 1/36 [..............................] - ETA: 0s - loss: 0.0230
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1072
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2112
36/36 [==============================] - 0s 3ms/step - loss: 0.2297
Epoch:  124
 1/36 [..............................] - ETA: 0s - loss: 0.0637
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1202
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2177
36/36 [==============================] - 0s 3ms/step - loss: 0.2259
Epoch:  125
 1/36 [..............................] - ETA: 0s - loss: 0.0343
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1184
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2228
36/36 [==============================] - 0s 3ms/step - loss: 0.2358
Epoch:  126
 1/36 [..............................] - ETA: 0s - loss: 0.0712
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1170
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2175
36/36 [==============================] - 0s 3ms/step - loss: 0.2268
Epoch:  127
 1/36 [..............................] - ETA: 0s - loss: 0.0251
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1316
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2262
36/36 [==============================] - 0s 3ms/step - loss: 0.2298
Epoch:  128
 1/36 [..............................] - ETA: 0s - loss: 0.0611
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1165
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2178
36/36 [==============================] - 0s 3ms/step - loss: 0.2277
Epoch:  129
 1/36 [..............................] - ETA: 0s - loss: 0.0054
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1126
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2190
36/36 [==============================] - 0s 3ms/step - loss: 0.2315
Epoch:  130
 1/36 [..............................] - ETA: 0s - loss: 0.0546
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1226
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.2014
36/36 [==============================] - 0s 3ms/step - loss: 0.2246
Epoch:  131
 1/36 [..............................] - ETA: 0s - loss: 0.0455
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1191
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2295
36/36 [==============================] - 0s 3ms/step - loss: 0.2364
Epoch:  132
 1/36 [..............................] - ETA: 0s - loss: 0.0626
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1136
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2113
36/36 [==============================] - 0s 3ms/step - loss: 0.2255
Epoch:  133
 1/36 [..............................] - ETA: 0s - loss: 0.0355
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1156
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2193
36/36 [==============================] - 0s 3ms/step - loss: 0.2307
Epoch:  134
 1/36 [..............................] - ETA: 0s - loss: 0.0529
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1140
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2167
36/36 [==============================] - 0s 3ms/step - loss: 0.2268
Epoch:  135
 1/36 [..............................] - ETA: 0s - loss: 0.0148
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1108
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2242
36/36 [==============================] - 0s 3ms/step - loss: 0.2309
Epoch:  136
 1/36 [..............................] - ETA: 0s - loss: 0.0461
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1063
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2146
36/36 [==============================] - 0s 3ms/step - loss: 0.2262
Epoch:  137
 1/36 [..............................] - ETA: 0s - loss: 0.0225
16/36 [============&gt;.................] - ETA: 0s - loss: 0.0993
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2085
36/36 [==============================] - 0s 3ms/step - loss: 0.2285
Epoch:  138
 1/36 [..............................] - ETA: 0s - loss: 0.0641
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1160
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2169
36/36 [==============================] - 0s 3ms/step - loss: 0.2261
Epoch:  139
 1/36 [..............................] - ETA: 0s - loss: 0.0339
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1144
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2184
36/36 [==============================] - 0s 3ms/step - loss: 0.2296
Epoch:  140
 1/36 [..............................] - ETA: 0s - loss: 0.0532
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1195
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2191
36/36 [==============================] - 0s 3ms/step - loss: 0.2289
Epoch:  141
 1/36 [..............................] - ETA: 0s - loss: 0.0270
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1090
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2111
36/36 [==============================] - 0s 3ms/step - loss: 0.2291
Epoch:  142
 1/36 [..............................] - ETA: 0s - loss: 0.0603
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1194
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2167
36/36 [==============================] - 0s 3ms/step - loss: 0.2247
Epoch:  143
 1/36 [..............................] - ETA: 0s - loss: 0.0384
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1192
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2225
36/36 [==============================] - 0s 3ms/step - loss: 0.2350
Epoch:  144
 1/36 [..............................] - ETA: 0s - loss: 0.0676
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1326
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2214
36/36 [==============================] - 0s 3ms/step - loss: 0.2256
Epoch:  145
 1/36 [..............................] - ETA: 0s - loss: 0.0293
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1164
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2133
36/36 [==============================] - 0s 3ms/step - loss: 0.2293
Epoch:  146
 1/36 [..............................] - ETA: 0s - loss: 0.0575
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1163
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2220
36/36 [==============================] - 0s 3ms/step - loss: 0.2265
Epoch:  147
 1/36 [..............................] - ETA: 0s - loss: 0.0101
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1132
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2185
36/36 [==============================] - 0s 3ms/step - loss: 0.2305
Epoch:  148
 1/36 [..............................] - ETA: 0s - loss: 0.0508
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1089
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2098
36/36 [==============================] - 0s 3ms/step - loss: 0.2260
Epoch:  149
 1/36 [..............................] - ETA: 0s - loss: 0.0177
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1096
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2149
36/36 [==============================] - 0s 3ms/step - loss: 0.2256
Epoch:  150
 1/36 [..............................] - ETA: 0s - loss: 0.0254
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1090
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2156
36/36 [==============================] - 0s 3ms/step - loss: 0.2271
Epoch:  151
 1/36 [..............................] - ETA: 0s - loss: 7.1549e-04
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1150    
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2195
36/36 [==============================] - 0s 3ms/step - loss: 0.2234
Epoch:  152
 1/36 [..............................] - ETA: 0s - loss: 0.0122
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1188
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2210
36/36 [==============================] - 0s 3ms/step - loss: 0.2326
Epoch:  153
 1/36 [..............................] - ETA: 0s - loss: 0.0040
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1182
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2106
36/36 [==============================] - 0s 3ms/step - loss: 0.2226
Epoch:  154
 1/36 [..............................] - ETA: 0s - loss: 0.0992
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1232
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2243
36/36 [==============================] - 0s 3ms/step - loss: 0.2365
Epoch:  155
 1/36 [..............................] - ETA: 0s - loss: 0.0111
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1145
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1872
36/36 [==============================] - 0s 4ms/step - loss: 0.2234
Epoch:  156
 1/36 [..............................] - ETA: 0s - loss: 0.0884
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1196
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2255
36/36 [==============================] - 0s 3ms/step - loss: 0.2308
Epoch:  157
 1/36 [..............................] - ETA: 0s - loss: 0.0015
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1131
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2151
36/36 [==============================] - 0s 3ms/step - loss: 0.2245
Epoch:  158
 1/36 [..............................] - ETA: 0s - loss: 0.0677
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1166
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2199
36/36 [==============================] - 0s 3ms/step - loss: 0.2316
Epoch:  159
 1/36 [..............................] - ETA: 0s - loss: 0.0043
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1096
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2132
36/36 [==============================] - 0s 3ms/step - loss: 0.2226
Epoch:  160
 1/36 [..............................] - ETA: 0s - loss: 0.0115
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1142
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2197
36/36 [==============================] - 0s 3ms/step - loss: 0.2321
Epoch:  161
 1/36 [..............................] - ETA: 0s - loss: 0.0031
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1101
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2128
36/36 [==============================] - 0s 3ms/step - loss: 0.2216
Epoch:  162
 1/36 [..............................] - ETA: 0s - loss: 0.1010
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1392
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2270
36/36 [==============================] - 0s 3ms/step - loss: 0.2320
Epoch:  163
 1/36 [..............................] - ETA: 0s - loss: 0.0085
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1082
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2141
36/36 [==============================] - 0s 3ms/step - loss: 0.2248
Epoch:  164
 1/36 [..............................] - ETA: 0s - loss: 0.0377
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1068
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2144
36/36 [==============================] - 0s 3ms/step - loss: 0.2259
Epoch:  165
 1/36 [..............................] - ETA: 0s - loss: 0.0106
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1154
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2167
36/36 [==============================] - 0s 3ms/step - loss: 0.2265
Epoch:  166
 1/36 [..............................] - ETA: 0s - loss: 0.0729
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1090
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2223
36/36 [==============================] - 0s 3ms/step - loss: 0.2286
Epoch:  167
 1/36 [..............................] - ETA: 0s - loss: 0.0154
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1180
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2105
36/36 [==============================] - 0s 3ms/step - loss: 0.2224
Epoch:  168
 1/36 [..............................] - ETA: 0s - loss: 0.0841
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1185
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2217
36/36 [==============================] - 0s 3ms/step - loss: 0.2339
Epoch:  169
 1/36 [..............................] - ETA: 0s - loss: 0.0227
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1130
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2190
36/36 [==============================] - 0s 3ms/step - loss: 0.2230
Epoch:  170
 1/36 [..............................] - ETA: 0s - loss: 0.0749
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1166
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2130
36/36 [==============================] - 0s 3ms/step - loss: 0.2284
Epoch:  171
 1/36 [..............................] - ETA: 0s - loss: 0.0124
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1121
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2191
36/36 [==============================] - 0s 3ms/step - loss: 0.2234
Epoch:  172
 1/36 [..............................] - ETA: 0s - loss: 0.0561
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1174
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2164
36/36 [==============================] - 0s 3ms/step - loss: 0.2250
Epoch:  173
 1/36 [..............................] - ETA: 0s - loss: 0.0121
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1276
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2216
36/36 [==============================] - 0s 3ms/step - loss: 0.2273
Epoch:  174
 1/36 [..............................] - ETA: 0s - loss: 0.0511
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1145
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2154
36/36 [==============================] - 0s 3ms/step - loss: 0.2247
Epoch:  175
 1/36 [..............................] - ETA: 0s - loss: 0.0326
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1055
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2152
36/36 [==============================] - 0s 3ms/step - loss: 0.2274
Epoch:  176
 1/36 [..............................] - ETA: 0s - loss: 0.0577
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1113
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2125
36/36 [==============================] - 0s 3ms/step - loss: 0.2201
Epoch:  177
 1/36 [..............................] - ETA: 0s - loss: 0.0412
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1176
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2177
36/36 [==============================] - 0s 3ms/step - loss: 0.2268
Epoch:  178
 1/36 [..............................] - ETA: 0s - loss: 0.0463
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1115
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2126
36/36 [==============================] - 0s 3ms/step - loss: 0.2204
Epoch:  179
 1/36 [..............................] - ETA: 0s - loss: 0.0234
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1081
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2136
36/36 [==============================] - 0s 3ms/step - loss: 0.2234
Epoch:  180
 1/36 [..............................] - ETA: 0s - loss: 0.0605
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1225
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2126
36/36 [==============================] - 0s 3ms/step - loss: 0.2233
Epoch:  181
 1/36 [..............................] - ETA: 0s - loss: 0.0209
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1039
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2125
36/36 [==============================] - 0s 3ms/step - loss: 0.2230
Epoch:  182
 1/36 [..............................] - ETA: 0s - loss: 0.0651
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1154
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2147
36/36 [==============================] - 0s 3ms/step - loss: 0.2222
Epoch:  183
 1/36 [..............................] - ETA: 0s - loss: 0.0158
17/36 [=============&gt;................] - ETA: 0s - loss: 0.0986
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2108
36/36 [==============================] - 0s 3ms/step - loss: 0.2221
Epoch:  184
 1/36 [..............................] - ETA: 0s - loss: 0.0695
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1119
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2108
36/36 [==============================] - 0s 3ms/step - loss: 0.2160
Epoch:  185
 1/36 [..............................] - ETA: 0s - loss: 0.0268
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1152
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1990
36/36 [==============================] - 0s 3ms/step - loss: 0.2176
Epoch:  186
 1/36 [..............................] - ETA: 0s - loss: 0.0559
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1156
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2107
36/36 [==============================] - 0s 3ms/step - loss: 0.2217
Epoch:  187
 1/36 [..............................] - ETA: 0s - loss: 0.0091
17/36 [=============&gt;................] - ETA: 0s - loss: 0.0899
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2046
36/36 [==============================] - 0s 3ms/step - loss: 0.2129
Epoch:  188
 1/36 [..............................] - ETA: 0s - loss: 0.0438
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1221
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2118
36/36 [==============================] - 0s 3ms/step - loss: 0.2204
Epoch:  189
 1/36 [..............................] - ETA: 0s - loss: 0.0047
16/36 [============&gt;.................] - ETA: 0s - loss: 0.0999
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2036
36/36 [==============================] - 0s 3ms/step - loss: 0.2154
Epoch:  190
 1/36 [..............................] - ETA: 0s - loss: 0.0964
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1190
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.2013
36/36 [==============================] - 0s 3ms/step - loss: 0.2181
Epoch:  191
 1/36 [..............................] - ETA: 0s - loss: 0.0086
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1005
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1914
36/36 [==============================] - 0s 3ms/step - loss: 0.2054
Epoch:  192
 1/36 [..............................] - ETA: 0s - loss: 0.0345
16/36 [============&gt;.................] - ETA: 0s - loss: 0.0991
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.1997
36/36 [==============================] - 0s 3ms/step - loss: 0.2027
Epoch:  193
 1/36 [..............................] - ETA: 0s - loss: 0.0015
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1106
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2051
36/36 [==============================] - 0s 3ms/step - loss: 0.1975
Epoch:  194
 1/36 [..............................] - ETA: 0s - loss: 0.0589
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1177
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2226
36/36 [==============================] - 0s 3ms/step - loss: 0.2301
Epoch:  195
 1/36 [..............................] - ETA: 0s - loss: 0.1236
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1643
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2570
36/36 [==============================] - 0s 3ms/step - loss: 0.2762
Epoch:  196
 1/36 [..............................] - ETA: 0s - loss: 0.0272
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.0928
29/36 [=======================&gt;......] - ETA: 0s - loss: 0.1725
36/36 [==============================] - 0s 4ms/step - loss: 0.2297
Epoch:  197
 1/36 [..............................] - ETA: 0s - loss: 0.0497
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1083
29/36 [=======================&gt;......] - ETA: 0s - loss: 0.1807
36/36 [==============================] - 0s 4ms/step - loss: 0.2322
Epoch:  198
 1/36 [..............................] - ETA: 0s - loss: 0.0168
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1158
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.1756
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2181
36/36 [==============================] - 0s 5ms/step - loss: 0.2319
Epoch:  199
 1/36 [..............................] - ETA: 0s - loss: 0.0127
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.1165
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.1737
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2162
36/36 [==============================] - 0s 6ms/step - loss: 0.2300
Epoch:  200
 1/36 [..............................] - ETA: 0s - loss: 0.0311
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1146
22/36 [=================&gt;............] - ETA: 0s - loss: 0.1418
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2242
36/36 [==============================] - 0s 5ms/step - loss: 0.2282
Epoch:  201
 1/36 [..............................] - ETA: 0s - loss: 0.0366
11/36 [========&gt;.....................] - ETA: 0s - loss: 0.1070
21/36 [================&gt;.............] - ETA: 0s - loss: 0.1333
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2098
36/36 [==============================] - 0s 5ms/step - loss: 0.2304
Epoch:  202
 1/36 [..............................] - ETA: 0s - loss: 0.0448
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1197
23/36 [==================&gt;...........] - ETA: 0s - loss: 0.1477
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2162
36/36 [==============================] - 0s 5ms/step - loss: 0.2264
Epoch:  203
 1/36 [..............................] - ETA: 0s - loss: 0.0479
11/36 [========&gt;.....................] - ETA: 0s - loss: 0.1159
20/36 [===============&gt;..............] - ETA: 0s - loss: 0.1424
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1884
36/36 [==============================] - 0s 6ms/step - loss: 0.2308
Epoch:  204
 1/36 [..............................] - ETA: 0s - loss: 0.0339
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1177
26/36 [====================&gt;.........] - ETA: 0s - loss: 0.1861
36/36 [==============================] - 0s 4ms/step - loss: 0.2268
Epoch:  205
 1/36 [..............................] - ETA: 0s - loss: 0.0328
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1159
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.1797
36/36 [==============================] - 0s 4ms/step - loss: 0.2312
Epoch:  206
 1/36 [..............................] - ETA: 0s - loss: 0.0278
 8/36 [=====&gt;........................] - ETA: 0s - loss: 0.1179
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1162
20/36 [===============&gt;..............] - ETA: 0s - loss: 0.1368
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1866
36/36 [==============================] - 0s 7ms/step - loss: 0.2235
Epoch:  207
 1/36 [..............................] - ETA: 0s - loss: 0.0673
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1279
26/36 [====================&gt;.........] - ETA: 0s - loss: 0.1874
36/36 [==============================] - 0s 4ms/step - loss: 0.2358
Epoch:  208
 1/36 [..............................] - ETA: 0s - loss: 0.0340
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1267
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2207
36/36 [==============================] - 0s 3ms/step - loss: 0.2241
Epoch:  209
 1/36 [..............................] - ETA: 0s - loss: 0.0595
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.1279
29/36 [=======================&gt;......] - ETA: 0s - loss: 0.1842
36/36 [==============================] - 0s 4ms/step - loss: 0.2308
Epoch:  210
 1/36 [..............................] - ETA: 0s - loss: 0.0241
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1139
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.1814
36/36 [==============================] - 0s 4ms/step - loss: 0.2251
Epoch:  211
 1/36 [..............................] - ETA: 0s - loss: 0.0440
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1122
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.1818
36/36 [==============================] - 0s 4ms/step - loss: 0.2286
Epoch:  212
 1/36 [..............................] - ETA: 0s - loss: 0.0379
11/36 [========&gt;.....................] - ETA: 0s - loss: 0.1124
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.1824
36/36 [==============================] - 0s 4ms/step - loss: 0.2239
Epoch:  213
 1/36 [..............................] - ETA: 0s - loss: 0.0558
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1168
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1895
36/36 [==============================] - 0s 4ms/step - loss: 0.2337
Epoch:  214
 1/36 [..............................] - ETA: 0s - loss: 0.0434
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1137
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2151
36/36 [==============================] - 0s 3ms/step - loss: 0.2246
Epoch:  215
 1/36 [..............................] - ETA: 0s - loss: 0.0488
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1199
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1880
36/36 [==============================] - 0s 4ms/step - loss: 0.2289
Epoch:  216
 1/36 [..............................] - ETA: 0s - loss: 0.0331
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1179
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1867
36/36 [==============================] - 0s 4ms/step - loss: 0.2251
Epoch:  217
 1/36 [..............................] - ETA: 0s - loss: 0.0343
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1174
21/36 [================&gt;.............] - ETA: 0s - loss: 0.1352
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.1843
36/36 [==============================] - 0s 6ms/step - loss: 0.2296
Epoch:  218
 1/36 [..............................] - ETA: 0s - loss: 0.0268
 8/36 [=====&gt;........................] - ETA: 0s - loss: 0.1163
20/36 [===============&gt;..............] - ETA: 0s - loss: 0.1365
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1868
36/36 [==============================] - 0s 5ms/step - loss: 0.2222
Epoch:  219
 1/36 [..............................] - ETA: 0s - loss: 0.0688
13/36 [=========&gt;....................] - ETA: 0s - loss: 0.1335
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.1836
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2282
36/36 [==============================] - 0s 5ms/step - loss: 0.2347
Epoch:  220
 1/36 [..............................] - ETA: 0s - loss: 0.0328
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1160
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.1788
36/36 [==============================] - 0s 4ms/step - loss: 0.2228
Epoch:  221
 1/36 [..............................] - ETA: 0s - loss: 0.0610
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1236
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.1885
36/36 [==============================] - 0s 4ms/step - loss: 0.2300
Epoch:  222
 1/36 [..............................] - ETA: 0s - loss: 0.0229
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1144
25/36 [===================&gt;..........] - ETA: 0s - loss: 0.1787
36/36 [==============================] - 0s 4ms/step - loss: 0.2240
Epoch:  223
 1/36 [..............................] - ETA: 0s - loss: 0.0458
 9/36 [======&gt;.......................] - ETA: 0s - loss: 0.1107
23/36 [==================&gt;...........] - ETA: 0s - loss: 0.1461
36/36 [==============================] - 0s 4ms/step - loss: 0.2280
Epoch:  224
 1/36 [..............................] - ETA: 0s - loss: 0.0362
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1216
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.1891
36/36 [==============================] - 0s 4ms/step - loss: 0.2228
Epoch:  225
 1/36 [..............................] - ETA: 0s - loss: 0.0576
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1261
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.1860
36/36 [==============================] - 0s 4ms/step - loss: 0.2334
Epoch:  226
 1/36 [..............................] - ETA: 0s - loss: 0.0417
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1169
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1879
36/36 [==============================] - 0s 4ms/step - loss: 0.2235
Epoch:  227
 1/36 [..............................] - ETA: 0s - loss: 0.0505
11/36 [========&gt;.....................] - ETA: 0s - loss: 0.1154
24/36 [===================&gt;..........] - ETA: 0s - loss: 0.1641
36/36 [==============================] - 0s 5ms/step - loss: 0.2321
Epoch:  228
 1/36 [..............................] - ETA: 0s - loss: 0.0480
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1175
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.1869
36/36 [==============================] - 0s 4ms/step - loss: 0.2242
Epoch:  229
 1/36 [..............................] - ETA: 0s - loss: 0.0436
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1131
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1869
36/36 [==============================] - 0s 4ms/step - loss: 0.2279
Epoch:  230
 1/36 [..............................] - ETA: 0s - loss: 0.0377
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1126
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1862
36/36 [==============================] - 0s 4ms/step - loss: 0.2245
Epoch:  231
 1/36 [..............................] - ETA: 0s - loss: 0.0296
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1180
24/36 [===================&gt;..........] - ETA: 0s - loss: 0.1634
36/36 [==============================] - ETA: 0s - loss: 0.2250
36/36 [==============================] - 0s 5ms/step - loss: 0.2250
Epoch:  232
 1/36 [..............................] - ETA: 0s - loss: 0.0150
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1151
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.1825
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2147
36/36 [==============================] - 0s 5ms/step - loss: 0.2253
Epoch:  233
 1/36 [..............................] - ETA: 0s - loss: 0.0173
12/36 [=========&gt;....................] - ETA: 0s - loss: 0.1151
24/36 [===================&gt;..........] - ETA: 0s - loss: 0.1616
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2095
36/36 [==============================] - 0s 5ms/step - loss: 0.2249
Epoch:  234
 1/36 [..............................] - ETA: 0s - loss: 0.0271
10/36 [=======&gt;......................] - ETA: 0s - loss: 0.1035
23/36 [==================&gt;...........] - ETA: 0s - loss: 0.1463
36/36 [==============================] - ETA: 0s - loss: 0.2273
36/36 [==============================] - 0s 5ms/step - loss: 0.2273
Epoch:  235
 1/36 [..............................] - ETA: 0s - loss: 0.0247
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1186
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1989
36/36 [==============================] - 0s 4ms/step - loss: 0.2225
Epoch:  236
 1/36 [..............................] - ETA: 0s - loss: 0.0051
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1199
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1876
36/36 [==============================] - 0s 4ms/step - loss: 0.2272
Epoch:  237
 1/36 [..............................] - ETA: 0s - loss: 0.0786
14/36 [==========&gt;...................] - ETA: 0s - loss: 0.1244
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.1906
36/36 [==============================] - 0s 4ms/step - loss: 0.2265
Epoch:  238
 1/36 [..............................] - ETA: 0s - loss: 0.0022
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1150
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2211
36/36 [==============================] - 0s 3ms/step - loss: 0.2261
Epoch:  239
 1/36 [..............................] - ETA: 0s - loss: 0.0328
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1123
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2145
36/36 [==============================] - 0s 3ms/step - loss: 0.2246
Epoch:  240
 1/36 [..............................] - ETA: 0s - loss: 0.0128
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1099
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1849
36/36 [==============================] - 0s 4ms/step - loss: 0.2249
Epoch:  241
 1/36 [..............................] - ETA: 0s - loss: 0.0196
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1136
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2158
36/36 [==============================] - 0s 3ms/step - loss: 0.2263
Epoch:  242
 1/36 [..............................] - ETA: 0s - loss: 0.0167
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1242
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2210
36/36 [==============================] - 0s 3ms/step - loss: 0.2248
Epoch:  243
 1/36 [..............................] - ETA: 0s - loss: 0.0153
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1143
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2187
36/36 [==============================] - 0s 3ms/step - loss: 0.2228
Epoch:  244
 1/36 [..............................] - ETA: 0s - loss: 0.0040
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1153
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.2010
36/36 [==============================] - 0s 3ms/step - loss: 0.2292
Epoch:  245
 1/36 [..............................] - ETA: 0s - loss: 0.0119
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1119
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2137
36/36 [==============================] - 0s 3ms/step - loss: 0.2232
Epoch:  246
 1/36 [..............................] - ETA: 0s - loss: 0.0081
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1135
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2150
36/36 [==============================] - 0s 3ms/step - loss: 0.2250
Epoch:  247
 1/36 [..............................] - ETA: 0s - loss: 0.0249
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1130
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2147
36/36 [==============================] - 0s 3ms/step - loss: 0.2246
Epoch:  248
 1/36 [..............................] - ETA: 0s - loss: 0.0200
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1137
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2160
36/36 [==============================] - 0s 3ms/step - loss: 0.2267
Epoch:  249
 1/36 [..............................] - ETA: 0s - loss: 0.0322
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1083
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2084
36/36 [==============================] - 0s 3ms/step - loss: 0.2243
Epoch:  250
 1/36 [..............................] - ETA: 0s - loss: 0.0134
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1052
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2128
36/36 [==============================] - 0s 3ms/step - loss: 0.2245
Epoch:  251
 1/36 [..............................] - ETA: 0s - loss: 0.0187
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1139
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2140
36/36 [==============================] - 0s 3ms/step - loss: 0.2229
Epoch:  252
 1/36 [..............................] - ETA: 0s - loss: 5.0116e-04
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1132    
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2170
36/36 [==============================] - 0s 3ms/step - loss: 0.2287
Epoch:  253
 1/36 [..............................] - ETA: 0s - loss: 0.0152
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1168
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1859
36/36 [==============================] - 0s 4ms/step - loss: 0.2232
Epoch:  254
 1/36 [..............................] - ETA: 0s - loss: 0.0048
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1124
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2098
36/36 [==============================] - 0s 3ms/step - loss: 0.2247
Epoch:  255
 1/36 [..............................] - ETA: 0s - loss: 0.0282
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1119
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2142
36/36 [==============================] - 0s 3ms/step - loss: 0.2242
Epoch:  256
 1/36 [..............................] - ETA: 0s - loss: 0.0166
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1129
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1991
36/36 [==============================] - 0s 4ms/step - loss: 0.2260
Epoch:  257
 1/36 [..............................] - ETA: 0s - loss: 0.0356
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1139
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2090
36/36 [==============================] - 0s 3ms/step - loss: 0.2216
Epoch:  258
 1/36 [..............................] - ETA: 0s - loss: 0.0160
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1148
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1880
36/36 [==============================] - 0s 4ms/step - loss: 0.2310
Epoch:  259
 1/36 [..............................] - ETA: 0s - loss: 0.0850
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1141
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2144
36/36 [==============================] - 0s 3ms/step - loss: 0.2234
Epoch:  260
 1/36 [..............................] - ETA: 0s - loss: 0.0062
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1130
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2158
36/36 [==============================] - 0s 3ms/step - loss: 0.2266
Epoch:  261
 1/36 [..............................] - ETA: 0s - loss: 0.0750
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1184
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2114
36/36 [==============================] - 0s 3ms/step - loss: 0.2252
Epoch:  262
 1/36 [..............................] - ETA: 0s - loss: 0.0012
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1093
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2095
36/36 [==============================] - 0s 3ms/step - loss: 0.2263
Epoch:  263
 1/36 [..............................] - ETA: 0s - loss: 0.0804
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1173
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2103
36/36 [==============================] - 0s 3ms/step - loss: 0.2219
Epoch:  264
 1/36 [..............................] - ETA: 0s - loss: 0.0126
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1185
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2197
36/36 [==============================] - 0s 3ms/step - loss: 0.2312
Epoch:  265
 1/36 [..............................] - ETA: 0s - loss: 0.0847
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1153
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2100
36/36 [==============================] - 0s 4ms/step - loss: 0.2225
Epoch:  266
 1/36 [..............................] - ETA: 0s - loss: 0.0058
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1221
28/36 [======================&gt;.......] - ETA: 0s - loss: 0.1882
36/36 [==============================] - 0s 4ms/step - loss: 0.2266
Epoch:  267
 1/36 [..............................] - ETA: 0s - loss: 0.0743
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1090
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1847
36/36 [==============================] - 0s 4ms/step - loss: 0.2252
Epoch:  268
 1/36 [..............................] - ETA: 0s - loss: 0.0434
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1322
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2207
36/36 [==============================] - 0s 3ms/step - loss: 0.2252
Epoch:  269
 1/36 [..............................] - ETA: 0s - loss: 0.0334
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1073
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2139
36/36 [==============================] - 0s 3ms/step - loss: 0.2255
Epoch:  270
 1/36 [..............................] - ETA: 0s - loss: 0.0460
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1172
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.2004
36/36 [==============================] - 0s 4ms/step - loss: 0.2219
Epoch:  271
 1/36 [..............................] - ETA: 0s - loss: 0.0448
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1162
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2242
36/36 [==============================] - 0s 3ms/step - loss: 0.2302
Epoch:  272
 1/36 [..............................] - ETA: 0s - loss: 0.0512
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1153
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2141
36/36 [==============================] - 0s 3ms/step - loss: 0.2224
Epoch:  273
 1/36 [..............................] - ETA: 0s - loss: 0.0380
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1146
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2157
36/36 [==============================] - 0s 3ms/step - loss: 0.2257
Epoch:  274
 1/36 [..............................] - ETA: 0s - loss: 0.0407
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1195
27/36 [=====================&gt;........] - ETA: 0s - loss: 0.1861
36/36 [==============================] - 0s 4ms/step - loss: 0.2226
Epoch:  275
 1/36 [..............................] - ETA: 0s - loss: 0.0252
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1139
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1996
36/36 [==============================] - 0s 4ms/step - loss: 0.2265
Epoch:  276
 1/36 [..............................] - ETA: 0s - loss: 0.0351
18/36 [==============&gt;...............] - ETA: 0s - loss: 0.1305
35/36 [============================&gt;.] - ETA: 0s - loss: 0.2205
36/36 [==============================] - 0s 3ms/step - loss: 0.2235
Epoch:  277
 1/36 [..............................] - ETA: 0s - loss: 0.0422
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1097
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1854
36/36 [==============================] - 0s 4ms/step - loss: 0.2265
Epoch:  278
 1/36 [..............................] - ETA: 0s - loss: 0.0406
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1136
34/36 [===========================&gt;..] - ETA: 0s - loss: 0.2165
36/36 [==============================] - 0s 3ms/step - loss: 0.2199
Epoch:  279
 1/36 [..............................] - ETA: 0s - loss: 0.0508
15/36 [===========&gt;..................] - ETA: 0s - loss: 0.1237
30/36 [========================&gt;.....] - ETA: 0s - loss: 0.1896
36/36 [==============================] - 0s 4ms/step - loss: 0.2306
Epoch:  280
 1/36 [..............................] - ETA: 0s - loss: 0.0459
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1130
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2079
36/36 [==============================] - 0s 3ms/step - loss: 0.2202
Epoch:  281
 1/36 [..............................] - ETA: 0s - loss: 0.0438
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1164
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2118
36/36 [==============================] - 0s 3ms/step - loss: 0.2260
Epoch:  282
 1/36 [..............................] - ETA: 0s - loss: 0.0356
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1116
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2123
36/36 [==============================] - 0s 3ms/step - loss: 0.2209
Epoch:  283
 1/36 [..............................] - ETA: 0s - loss: 0.0310
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1094
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2137
36/36 [==============================] - 0s 3ms/step - loss: 0.2241
Epoch:  284
 1/36 [..............................] - ETA: 0s - loss: 0.0464
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1178
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2153
36/36 [==============================] - 0s 3ms/step - loss: 0.2234
Epoch:  285
 1/36 [..............................] - ETA: 0s - loss: 0.0286
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1070
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2080
36/36 [==============================] - 0s 4ms/step - loss: 0.2240
Epoch:  286
 1/36 [..............................] - ETA: 0s - loss: 0.0507
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1179
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2102
36/36 [==============================] - 0s 3ms/step - loss: 0.2229
Epoch:  287
 1/36 [..............................] - ETA: 0s - loss: 0.0237
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1035
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2067
36/36 [==============================] - 0s 3ms/step - loss: 0.2234
Epoch:  288
 1/36 [..............................] - ETA: 0s - loss: 0.0550
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1135
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2118
36/36 [==============================] - 0s 3ms/step - loss: 0.2187
Epoch:  289
 1/36 [..............................] - ETA: 0s - loss: 0.0335
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1154
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2101
36/36 [==============================] - 0s 3ms/step - loss: 0.2224
Epoch:  290
 1/36 [..............................] - ETA: 0s - loss: 0.0429
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1123
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2113
36/36 [==============================] - 0s 3ms/step - loss: 0.2183
Epoch:  291
 1/36 [..............................] - ETA: 0s - loss: 0.0230
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1078
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1962
36/36 [==============================] - 0s 4ms/step - loss: 0.2208
Epoch:  292
 1/36 [..............................] - ETA: 0s - loss: 0.0520
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1211
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.2012
36/36 [==============================] - 0s 3ms/step - loss: 0.2197
Epoch:  293
 1/36 [..............................] - ETA: 0s - loss: 0.0220
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1048
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1954
36/36 [==============================] - 0s 4ms/step - loss: 0.2212
Epoch:  294
 1/36 [..............................] - ETA: 0s - loss: 0.0549
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1173
32/36 [=========================&gt;....] - ETA: 0s - loss: 0.2089
36/36 [==============================] - 0s 3ms/step - loss: 0.2187
Epoch:  295
 1/36 [..............................] - ETA: 0s - loss: 0.0190
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1021
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1942
36/36 [==============================] - 0s 4ms/step - loss: 0.2197
Epoch:  296
 1/36 [..............................] - ETA: 0s - loss: 0.0575
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1132
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2111
36/36 [==============================] - 0s 3ms/step - loss: 0.2169
Epoch:  297
 1/36 [..............................] - ETA: 0s - loss: 0.0165
17/36 [=============&gt;................] - ETA: 0s - loss: 0.1008
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2088
36/36 [==============================] - 0s 3ms/step - loss: 0.2182
Epoch:  298
 1/36 [..............................] - ETA: 0s - loss: 0.0595
16/36 [============&gt;.................] - ETA: 0s - loss: 0.1127
31/36 [========================&gt;.....] - ETA: 0s - loss: 0.1969
36/36 [==============================] - 0s 4ms/step - loss: 0.2139
Epoch:  299
 1/36 [..............................] - ETA: 0s - loss: 0.0149
17/36 [=============&gt;................] - ETA: 0s - loss: 0.0994
33/36 [==========================&gt;...] - ETA: 0s - loss: 0.2075
36/36 [==============================] - 0s 3ms/step - loss: 0.2160
Epoch:  300
 1/12 [=&gt;............................] - ETA: 9s
12/12 [==============================] - 1s 2ms/step</code></pre>
</div>
</div>
<div class="cell" data-hash="modelo_sltm_cache/html/unnamed-chunk-36_012b1c9c0d2ff213e47c602b59652307">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>future_gold_ts_tbl <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter_time</span>(<span class="st">"2013"</span> <span class="sc">~</span> <span class="st">"end"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_prediction</span>(<span class="at">id =</span> <span class="cn">NULL</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sunspots: Ten Year Forecast"</span>, <span class="at">subtitle =</span> <span class="st">"Forecast Horizon: 2013 - 2023"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelo_sltm_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="1440"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>